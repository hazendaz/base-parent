<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HtmlCompressor.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HTML Compressor and Minifier</a> &gt; <a href="index.source.html" class="el_package">com.googlecode.htmlcompressor.compressor</a> &gt; <span class="el_source">HtmlCompressor.java</span></div><h1>HtmlCompressor.java</h1><pre class="source lang-java linenums">/**
 * ====
 *     ====
 *         ====
 *                Copyright 2009-2016 the original author or authors.
 *
 *                Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *                you may not use this file except in compliance with the License.
 *                You may obtain a copy of the License at
 *
 *                   http://www.apache.org/licenses/LICENSE-2.0
 *
 *                Unless required by applicable law or agreed to in writing, software
 *                distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *                WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *                See the License for the specific language governing permissions and
 *                limitations under the License.
 *         ====
 *
 *            Copyright 2009-2017 the original author or authors.
 *
 *            Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *            you may not use this file except in compliance with the License.
 *            You may obtain a copy of the License at
 *
 *               http://www.apache.org/licenses/LICENSE-2.0
 *
 *            Unless required by applicable law or agreed to in writing, software
 *            distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *            WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *            See the License for the specific language governing permissions and
 *            limitations under the License.
 *     ====
 *
 *        Copyright 2009-2017 the original author or authors.
 *
 *        Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *        you may not use this file except in compliance with the License.
 *        You may obtain a copy of the License at
 *
 *           http://www.apache.org/licenses/LICENSE-2.0
 *
 *        Unless required by applicable law or agreed to in writing, software
 *        distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *        See the License for the specific language governing permissions and
 *        limitations under the License.
 * ====
 *
 *    Copyright 2009-2017 the original author or authors.
 *
 *    Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 *    you may not use this file except in compliance with the License.
 *    You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 *    Unless required by applicable law or agreed to in writing, software
 *    distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *    See the License for the specific language governing permissions and
<span class="nc" id="L62"> *    limitations under the License.</span>
 */
package com.googlecode.htmlcompressor.compressor;

import java.text.MessageFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.mozilla.javascript.ErrorReporter;
<span class="nc" id="L74"></span>
/**
 * Class that compresses given HTML source by removing comments, extra spaces and lin&amp;lt;pre&amp;gt; while preserving
 * content within &amp;lt;pre&amp;gt;, &amp;lt;textarea&amp;gt;, &amp;lt;script&amp;gt; and &amp;lt;style&amp;gt; tags.
 * &lt;p&gt;
 * Blocks that should be additionally preserved could be marked with: &lt;br&gt;
 * &lt;code&gt;&amp;lt;!-- {{{ --&amp;gt;
<span class="nc" id="L81"> * &lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...</span>
 * &lt;br&gt;&amp;lt;!-- }}} --&amp;gt;&lt;/code&gt; &lt;br&gt;
 * or any number of user defined patterns.
 * &lt;p&gt;
 * Content inside &amp;lt;script&amp;gt; or &amp;lt;style&amp;gt; tags could be optionally compressed using &lt;a
 * href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt; or &lt;a
<span class="nc" id="L87"> * href=&quot;http://code.google.com/closure/compiler/&quot;&gt;Google Closure Compiler&lt;/a&gt; libraries.</span>
 * 
 * @author &lt;a href=&quot;mailto:serg472@gmail.com&quot;&gt;Sergiy Kovalchuk&lt;/a&gt;
 */
public class HtmlCompressor implements Compressor {

    /** The Constant JS_COMPRESSOR_YUI. */
    public static final String       JS_COMPRESSOR_YUI            = &quot;yui&quot;;

    /** The Constant JS_COMPRESSOR_CLOSURE. */
    public static final String       JS_COMPRESSOR_CLOSURE        = &quot;closure&quot;;

    /**
     * Predefined pattern that matches &lt;code&gt;&amp;lt;?php ... ?&amp;gt;&lt;/code&gt; tags. Could be passed inside a list to
     * {@link #setPreservePatterns(List) setPreservePatterns} method.
     */
    public static final Pattern      PHP_TAG_PATTERN              = Pattern.compile(&quot;&lt;\\?php.*?\\?&gt;&quot;, Pattern.DOTALL
                                                                          | Pattern.CASE_INSENSITIVE);

    /**
     * Predefined pattern that matches &lt;code&gt;&amp;lt;% ... %&amp;gt;&lt;/code&gt; tags. Could be passed inside a list to
     * {@link #setPreservePatterns(List) setPreservePatterns} method.
     */
<span class="nc" id="L110">    public static final Pattern      SERVER_SCRIPT_TAG_PATTERN    = Pattern.compile(&quot;&lt;%.*?%&gt;&quot;, Pattern.DOTALL);</span>

    /**
     * Predefined pattern that matches &lt;code&gt;&amp;lt;--# ... --&amp;gt;&lt;/code&gt; tags. Could be passed inside a list to
     * {@link #setPreservePatterns(List) setPreservePatterns} method.
     */
    public static final Pattern      SERVER_SIDE_INCLUDE_PATTERN  = Pattern.compile(&quot;&lt;!--\\s*#.*?--&gt;&quot;, Pattern.DOTALL);

    /**
     * Predefined list of tags that are very likely to be block-level. Could be passed to
     * {@link #setRemoveSurroundingSpaces(String) setRemoveSurroundingSpaces} method.
     */
    public static final String       BLOCK_TAGS_MIN               = &quot;html,head,body,br,p&quot;;
<span class="nc" id="L123"></span>
    /**
     * Predefined list of tags that are block-level by default, excluding &lt;code&gt;&amp;lt;div&amp;gt;&lt;/code&gt; and
<span class="nc" id="L126">     * &lt;code&gt;&amp;lt;li&amp;gt;&lt;/code&gt; tags. Table tags are also included. Could be passed to</span>
     * {@link #setRemoveSurroundingSpaces(String) setRemoveSurroundingSpaces} method.
     */
    public static final String       BLOCK_TAGS_MAX               = BLOCK_TAGS_MIN
                                                                          + &quot;,h1,h2,h3,h4,h5,h6,blockquote,center,dl,fieldset,form,frame,frameset,hr,noframes,ol,table,tbody,tr,td,th,tfoot,thead,ul&quot;;

    /**
     * Could be passed to {@link #setRemoveSurroundingSpaces(String) setRemoveSurroundingSpaces} method to remove all
     * surrounding spaces (not recommended).
     */
    public static final String       ALL_TAGS                     = &quot;all&quot;;

    /** The enabled. */
    private boolean                  enabled                      = true;

    // javascript and css compressor implementations

    /** The java script compressor. */
    private Compressor               javaScriptCompressor;

    /** The css compressor. */
    private Compressor               cssCompressor;

    // default settings

    /** The remove comments. */
    private boolean                  removeComments               = true;

    /** The remove multi spaces. */
    private boolean                  removeMultiSpaces            = true;

    // optional settings

    /** The remove intertag spaces. */
    private boolean                  removeIntertagSpaces;

    /** The remove quotes. */
    private boolean                  removeQuotes;

    /** The compress java script. */
    private boolean                  compressJavaScript;

    /** The compress css. */
    private boolean                  compressCss;

    /** The simple doctype. */
    private boolean                  simpleDoctype;

    /** The remove script attributes. */
    private boolean                  removeScriptAttributes;

    /** The remove style attributes. */
    private boolean                  removeStyleAttributes;

    /** The remove link attributes. */
    private boolean                  removeLinkAttributes;

    /** The remove form attributes. */
    private boolean                  removeFormAttributes;

    /** The remove input attributes. */
    private boolean                  removeInputAttributes;

    /** The simple boolean attributes. */
    private boolean                  simpleBooleanAttributes;

    /** The remove java script protocol. */
    private boolean                  removeJavaScriptProtocol;

    /** The remove http protocol. */
    private boolean                  removeHttpProtocol;

    /** The remove https protocol. */
    private boolean                  removeHttpsProtocol;

<span class="nc" id="L201">    /** The preserve line breaks. */</span>
    private boolean                  preserveLineBreaks;

<span class="nc" id="L204">    /** The remove surrounding spaces. */</span>
    private String                   removeSurroundingSpaces;

    /** The preserve patterns. */
    private List&lt;Pattern&gt;            preservePatterns;

    // statistics

    /** The generate statistics. */
    private boolean                  generateStatistics;

    /** The statistics. */
    private HtmlCompressorStatistics statistics;

    // YUICompressor settings

    /** The yui js no munge. */
    private boolean                  yuiJsNoMunge;

    /** The yui js preserve all semi colons. */
    private boolean                  yuiJsPreserveAllSemiColons;

    /** The yui js disable optimizations. */
    private boolean                  yuiJsDisableOptimizations;

    /** The yui js line break. */
    private int                      yuiJsLineBreak               = -1;

    /** The yui css line break. */
    private int                      yuiCssLineBreak              = -1;

    /** The yui error reporter. */
    // error reporter implementation for YUI compressor
    private ErrorReporter            yuiErrorReporter;

    /** The Constant tempCondCommentBlock. */
<span class="nc" id="L240">    // temp replacements for preserved blocks</span>
    protected static final String    TEMP_COND_COMMENT_BLOCK      = &quot;%%%~COMPRESS~COND~{0,number,#}~%%%&quot;;

<span class="nc" id="L243">    /** The Constant tempPreBlock. */</span>
<span class="nc" id="L244">    protected static final String    TEMP_PRE_BLOCK               = &quot;%%%~COMPRESS~PRE~{0,number,#}~%%%&quot;;</span>

    /** The Constant tempTextAreaBlock. */
    protected static final String    TEMP_TEXT_AREA_BLOCK         = &quot;%%%~COMPRESS~TEXTAREA~{0,number,#}~%%%&quot;;

    /** The Constant tempScriptBlock. */
<span class="nc" id="L250">    protected static final String    TEMP_SCRIPT_BLOCK            = &quot;%%%~COMPRESS~SCRIPT~{0,number,#}~%%%&quot;;</span>
<span class="nc" id="L251"></span>
    /** The Constant tempStyleBlock. */
    protected static final String    TEMP_STYLE_BLOCK             = &quot;%%%~COMPRESS~STYLE~{0,number,#}~%%%&quot;;

    /** The Constant tempEventBlock. */
    protected static final String    TEMP_EVENT_BLOCK             = &quot;%%%~COMPRESS~EVENT~{0,number,#}~%%%&quot;;
<span class="nc" id="L257"></span>
    /** The Constant tempLineBreakBlock. */
    protected static final String    TEMP_LINE_BREAK_BLOCK        = &quot;%%%~COMPRESS~LT~{0,number,#}~%%%&quot;;

<span class="nc" id="L261">    /** The Constant tempSkipBlock. */</span>
    protected static final String    TEMP_SKIP_BLOCK              = &quot;%%%~COMPRESS~SKIP~{0,number,#}~%%%&quot;;

    /** The Constant tempUserBlock. */
<span class="nc" id="L265">    protected static final String    TEMP_USER_BLOCK              = &quot;%%%~COMPRESS~USER{0,number,#}~{1,number,#}~%%%&quot;;</span>

    /** The Constant emptyPattern. */
    // compiled regex patterns
<span class="nc" id="L269">    protected static final Pattern   emptyPattern                 = Pattern.compile(&quot;\\s&quot;);</span>

    /** The Constant skipPattern. */
    protected static final Pattern   skipPattern                  = Pattern
<span class="nc" id="L273">                                                                          .compile(</span>
                                                                                  &quot;&lt;!--\\s*\\{\\{\\{\\s*--&gt;(.*?)&lt;!--\\s*\\}\\}\\}\\s*--&gt;&quot;,
                                                                                  Pattern.DOTALL
                                                                                          | Pattern.CASE_INSENSITIVE);
<span class="nc" id="L277"></span>
    /** The Constant condCommentPattern. */
    protected static final Pattern   condCommentPattern           = Pattern
                                                                          .compile(
<span class="nc" id="L281">                                                                                  &quot;(&lt;!(?:--)?\\[[^\\]]+?]&gt;)(.*?)(&lt;!\\[[^\\]]+]--&gt;)&quot;,</span>
                                                                                  Pattern.DOTALL
                                                                                          | Pattern.CASE_INSENSITIVE);

<span class="nc" id="L285">    /** The Constant commentPattern. */</span>
    protected static final Pattern   commentPattern               = Pattern.compile(&quot;&lt;!----&gt;|&lt;!--[^\\[].*?--&gt;&quot;,
                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);

<span class="nc" id="L289">    /** The Constant intertagPattern_TagTag. */</span>
<span class="nc" id="L290">    protected static final Pattern   intertagPattern_TagTag       = Pattern.compile(&quot;&gt;\\s+&lt;&quot;, Pattern.DOTALL</span>
                                                                          | Pattern.CASE_INSENSITIVE);

    /** The Constant intertagPattern_TagCustom. */
    protected static final Pattern   intertagPattern_TagCustom    = Pattern.compile(&quot;&gt;\\s+%%%~&quot;, Pattern.DOTALL
<span class="nc" id="L295">                                                                          | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant intertagPattern_CustomTag. */
    protected static final Pattern   intertagPattern_CustomTag    = Pattern.compile(&quot;~%%%\\s+&lt;&quot;, Pattern.DOTALL
<span class="nc" id="L299">                                                                          | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant intertagPattern_CustomCustom. */
    protected static final Pattern   intertagPattern_CustomCustom = Pattern.compile(&quot;~%%%\\s+%%%~&quot;, Pattern.DOTALL
                                                                          | Pattern.CASE_INSENSITIVE);
<span class="nc" id="L304"></span>
    /** The Constant multispacePattern. */
    protected static final Pattern   multispacePattern            = Pattern.compile(&quot;\\s+&quot;, Pattern.DOTALL
                                                                          | Pattern.CASE_INSENSITIVE);
<span class="nc" id="L308"></span>
    /** The Constant tagEndSpacePattern. */
    protected static final Pattern   tagEndSpacePattern           = Pattern.compile(&quot;(&lt;(?:[^&gt;]+?))(?:\\s+?)(/?&gt;)&quot;,
                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);
<span class="nc" id="L312"></span>
    /** The Constant tagLastUnquotedValuePattern. */
    protected static final Pattern   tagLastUnquotedValuePattern  = Pattern.compile(&quot;=\\s*[a-z0-9-_]+$&quot;,
                                                                          Pattern.CASE_INSENSITIVE);
<span class="nc" id="L316"></span>
    /** The Constant tagQuotePattern. */
    protected static final Pattern   tagQuotePattern              = Pattern
                                                                          .compile(
                                                                                  &quot;\\s*=\\s*([\&quot;'])([a-z0-9-_]+?)\\1(/?)(?=[^&lt;]*?&gt;)&quot;,
<span class="nc" id="L321">                                                                                  Pattern.CASE_INSENSITIVE);</span>

    /** The Constant prePattern. */
    protected static final Pattern   prePattern                   = Pattern.compile(&quot;(&lt;pre[^&gt;]*?&gt;)(.*?)(&lt;/pre&gt;)&quot;,
<span class="nc" id="L325">                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant taPattern. */
    protected static final Pattern   taPattern                    = Pattern.compile(
<span class="nc" id="L329">                                                                          &quot;(&lt;textarea[^&gt;]*?&gt;)(.*?)(&lt;/textarea&gt;)&quot;,</span>
<span class="nc" id="L330">                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant scriptPattern. */
    protected static final Pattern   scriptPattern                = Pattern.compile(&quot;(&lt;script[^&gt;]*?&gt;)(.*?)(&lt;/script&gt;)&quot;,
                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);

<span class="nc" id="L336">    /** The Constant stylePattern. */</span>
<span class="nc" id="L337">    protected static final Pattern   stylePattern                 = Pattern.compile(&quot;(&lt;style[^&gt;]*?&gt;)(.*?)(&lt;/style&gt;)&quot;,</span>
                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);

    /** The Constant tagPropertyPattern. */
    protected static final Pattern   tagPropertyPattern           = Pattern.compile(&quot;(\\s\\w+)\\s*=\\s*(?=[^&lt;]*?&gt;)&quot;,
                                                                          Pattern.CASE_INSENSITIVE);
<span class="nc" id="L343"></span>
<span class="nc" id="L344">    /** The Constant cdataPattern. */</span>
    protected static final Pattern   cdataPattern                 = Pattern.compile(
                                                                          &quot;\\s*&lt;!\\[CDATA\\[(.*?)\\]\\]&gt;\\s*&quot;,
                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);

    /** The Constant doctypePattern. */
<span class="nc" id="L350">    protected static final Pattern   doctypePattern               = Pattern.compile(&quot;&lt;!DOCTYPE[^&gt;]*&gt;&quot;, Pattern.DOTALL</span>
<span class="nc" id="L351">                                                                          | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant typeAttrPattern. */
    protected static final Pattern   typeAttrPattern              = Pattern.compile(&quot;type\\s*=\\s*([\\\&quot;']*)(.+?)\\1&quot;,
                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);

<span class="nc" id="L357">    /** The Constant jsTypeAttrPattern. */</span>
<span class="nc" id="L358">    protected static final Pattern   jsTypeAttrPattern            = Pattern</span>
                                                                          .compile(
                                                                                  &quot;(&lt;script[^&gt;]*)type\\s*=\\s*([\&quot;']*)(?:text|application)/javascript\\2([^&gt;]*&gt;)&quot;,
                                                                                  Pattern.DOTALL
                                                                                          | Pattern.CASE_INSENSITIVE);

<span class="nc" id="L364">    /** The Constant jsLangAttrPattern. */</span>
<span class="nc" id="L365">    protected static final Pattern   jsLangAttrPattern            = Pattern</span>
                                                                          .compile(
                                                                                  &quot;(&lt;script[^&gt;]*)language\\s*=\\s*([\&quot;']*)javascript\\2([^&gt;]*&gt;)&quot;,
                                                                                  Pattern.DOTALL
                                                                                          | Pattern.CASE_INSENSITIVE);

<span class="nc" id="L371">    /** The Constant styleTypeAttrPattern. */</span>
<span class="nc" id="L372">    protected static final Pattern   styleTypeAttrPattern         = Pattern</span>
                                                                          .compile(
                                                                                  &quot;(&lt;style[^&gt;]*)type\\s*=\\s*([\&quot;']*)text/style\\2([^&gt;]*&gt;)&quot;,
                                                                                  Pattern.DOTALL
                                                                                          | Pattern.CASE_INSENSITIVE);

<span class="nc" id="L378">    /** The Constant linkTypeAttrPattern. */</span>
<span class="nc" id="L379">    protected static final Pattern   linkTypeAttrPattern          = Pattern</span>
                                                                          .compile(
                                                                                  &quot;(&lt;link[^&gt;]*)type\\s*=\\s*([\&quot;']*)text/(?:css|plain)\\2([^&gt;]*&gt;)&quot;,
                                                                                  Pattern.DOTALL
                                                                                          | Pattern.CASE_INSENSITIVE);

<span class="nc" id="L385">    /** The Constant linkRelAttrPattern. */</span>
    protected static final Pattern   linkRelAttrPattern           = Pattern
                                                                          .compile(
                                                                                  &quot;&lt;link(?:[^&gt;]*)rel\\s*=\\s*([\&quot;']*)(?:alternate\\s+)?stylesheet\\1(?:[^&gt;]*)&gt;&quot;,
<span class="nc" id="L389">                                                                                  Pattern.DOTALL</span>
<span class="nc" id="L390">                                                                                          | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant formMethodAttrPattern. */
    protected static final Pattern   formMethodAttrPattern        = Pattern
                                                                          .compile(
                                                                                  &quot;(&lt;form[^&gt;]*)method\\s*=\\s*([\&quot;']*)get\\2([^&gt;]*&gt;)&quot;,
<span class="nc" id="L396">                                                                                  Pattern.DOTALL</span>
<span class="nc" id="L397">                                                                                          | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant inputTypeAttrPattern. */
    protected static final Pattern   inputTypeAttrPattern         = Pattern
                                                                          .compile(
                                                                                  &quot;(&lt;input[^&gt;]*)type\\s*=\\s*([\&quot;']*)text\\2([^&gt;]*&gt;)&quot;,
<span class="nc" id="L403">                                                                                  Pattern.DOTALL</span>
<span class="nc" id="L404">                                                                                          | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant booleanAttrPattern. */
    protected static final Pattern   booleanAttrPattern           = Pattern
                                                                          .compile(
                                                                                  &quot;(&lt;\\w+[^&gt;]*)(checked|selected|disabled|readonly)\\s*=\\s*([\&quot;']*)\\w*\\3([^&gt;]*&gt;)&quot;,
<span class="nc" id="L410">                                                                                  Pattern.DOTALL</span>
<span class="nc" id="L411">                                                                                          | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant eventJsProtocolPattern. */
    protected static final Pattern   eventJsProtocolPattern       = Pattern.compile(&quot;^javascript:\\s*(.+)&quot;,
                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);

<span class="nc" id="L417">    /** The Constant httpProtocolPattern. */</span>
<span class="nc" id="L418">    protected static final Pattern   httpProtocolPattern          = Pattern</span>
                                                                          .compile(
                                                                                  &quot;(&lt;[^&gt;]+?(?:href|src|cite|action)\\s*=\\s*['\&quot;])http:(//[^&gt;]+?&gt;)&quot;,
                                                                                  Pattern.DOTALL
                                                                                          | Pattern.CASE_INSENSITIVE);
<span class="nc" id="L423"></span>
<span class="nc" id="L424">    /** The Constant httpsProtocolPattern. */</span>
    protected static final Pattern   httpsProtocolPattern         = Pattern
                                                                          .compile(
<span class="nc" id="L427">                                                                                  &quot;(&lt;[^&gt;]+?(?:href|src|cite|action)\\s*=\\s*['\&quot;])https:(//[^&gt;]+?&gt;)&quot;,</span>
                                                                                  Pattern.DOTALL
<span class="nc" id="L429">                                                                                          | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant relExternalPattern. */
    protected static final Pattern   relExternalPattern           = Pattern
                                                                          .compile(
<span class="nc" id="L434">                                                                                  &quot;&lt;(?:[^&gt;]*)rel\\s*=\\s*([\&quot;']*)(?:alternate\\s+)?external\\1(?:[^&gt;]*)&gt;&quot;,</span>
                                                                                  Pattern.DOTALL
<span class="nc" id="L436">                                                                                          | Pattern.CASE_INSENSITIVE);</span>

    /** The Constant eventPattern1. */
    protected static final Pattern   eventPattern1                = Pattern
                                                                          .compile(
<span class="nc" id="L441">                                                                                  &quot;(\\son[a-z]+\\s*=\\s*\&quot;)([^\&quot;\\\\\\r\\n]*(?:\\\\.[^\&quot;\\\\\\r\\n]*)*)(\&quot;)&quot;,</span>
                                                                                  Pattern.CASE_INSENSITIVE);                                                                                          // unmasked:

    /** The Constant eventPattern2. */
    // \son[a-z]+\s*=\s*&quot;[^&quot;\\\r\n]*(?:\\.[^&quot;\\\r\n]*)*&quot;
<span class="nc" id="L446">    protected static final Pattern   eventPattern2                = Pattern</span>
                                                                          .compile(
                                                                                  &quot;(\\son[a-z]+\\s*=\\s*')([^'\\\\\\r\\n]*(?:\\\\.[^'\\\\\\r\\n]*)*)(')&quot;,
<span class="nc" id="L449">                                                                                  Pattern.CASE_INSENSITIVE);</span>

    /** The Constant lineBreakPattern. */
<span class="nc" id="L452">    protected static final Pattern   lineBreakPattern             = Pattern</span>
<span class="nc" id="L453">                                                                          .compile(&quot;(?:\\p{Blank}*(\\r?\\n)\\p{Blank}*)+&quot;);</span>

    /** The Constant surroundingSpacesMinPattern. */
<span class="nc" id="L456">    protected static final Pattern   surroundingSpacesMinPattern  = Pattern.compile(</span>
                                                                          &quot;\\s*(&lt;/?(?:&quot;
                                                                                  + BLOCK_TAGS_MIN.replaceAll(&quot;,&quot;, &quot;|&quot;)
<span class="nc" id="L459">                                                                                  + &quot;)(?:&gt;|[\\s/][^&gt;]*&gt;))\\s*&quot;,</span>
                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);

<span class="nc" id="L462">    /** The Constant surroundingSpacesMaxPattern. */</span>
    protected static final Pattern   surroundingSpacesMaxPattern  = Pattern.compile(
                                                                          &quot;\\s*(&lt;/?(?:&quot;
<span class="nc" id="L465">                                                                                  + BLOCK_TAGS_MAX.replaceAll(&quot;,&quot;, &quot;|&quot;)</span>
                                                                                  + &quot;)(?:&gt;|[\\s/][^&gt;]*&gt;))\\s*&quot;,
                                                                          Pattern.DOTALL | Pattern.CASE_INSENSITIVE);
<span class="nc" id="L468"></span>
    /** The Constant surroundingSpacesAllPattern. */
    protected static final Pattern   surroundingSpacesAllPattern  = Pattern.compile(&quot;\\s*(&lt;[^&gt;]+&gt;)\\s*&quot;, Pattern.DOTALL
                                                                          | Pattern.CASE_INSENSITIVE);

    /** The Constant tempCondCommentPattern. */
    // patterns for searching for temporary replacements
    protected static final Pattern   tempCondCommentPattern       = Pattern.compile(&quot;%%%~COMPRESS~COND~(\\d+?)~%%%&quot;);

    /** The Constant tempPrePattern. */
    protected static final Pattern   tempPrePattern               = Pattern.compile(&quot;%%%~COMPRESS~PRE~(\\d+?)~%%%&quot;);
<span class="nc bnc" id="L479" title="All 6 branches missed."></span>
<span class="nc" id="L480">    /** The Constant tempTextAreaPattern. */</span>
    protected static final Pattern   tempTextAreaPattern          = Pattern
                                                                          .compile(&quot;%%%~COMPRESS~TEXTAREA~(\\d+?)~%%%&quot;);

<span class="nc" id="L484">    /** The Constant tempScriptPattern. */</span>
    protected static final Pattern   tempScriptPattern            = Pattern.compile(&quot;%%%~COMPRESS~SCRIPT~(\\d+?)~%%%&quot;);

<span class="nc" id="L487">    /** The Constant tempStylePattern. */</span>
<span class="nc" id="L488">    protected static final Pattern   tempStylePattern             = Pattern.compile(&quot;%%%~COMPRESS~STYLE~(\\d+?)~%%%&quot;);</span>
<span class="nc" id="L489"></span>
<span class="nc" id="L490">    /** The Constant tempEventPattern. */</span>
<span class="nc" id="L491">    protected static final Pattern   tempEventPattern             = Pattern.compile(&quot;%%%~COMPRESS~EVENT~(\\d+?)~%%%&quot;);</span>
<span class="nc" id="L492"></span>
<span class="nc" id="L493">    /** The Constant tempSkipPattern. */</span>
<span class="nc" id="L494">    protected static final Pattern   tempSkipPattern              = Pattern.compile(&quot;%%%~COMPRESS~SKIP~(\\d+?)~%%%&quot;);</span>
<span class="nc" id="L495"></span>
    /** The Constant tempLineBreakPattern. */
    protected static final Pattern   tempLineBreakPattern         = Pattern.compile(&quot;%%%~COMPRESS~LT~(\\d+?)~%%%&quot;);
<span class="nc" id="L498"></span>
    /**
     * The main method that compresses given HTML source and returns compressed result.
     * 
<span class="nc" id="L502">     * @param html</span>
     *            HTML content to compress
     * @return compressed content.
<span class="nc" id="L505">     */</span>
    @Override
    public String compress(String html) {
        if (!enabled || html == null || html.length() == 0) {
<span class="nc" id="L509">            return html;</span>
        }

        // calculate uncompressed statistics
<span class="nc" id="L513">        initStatistics(html);</span>

<span class="nc" id="L515">        // preserved block containers</span>
        List&lt;String&gt; condCommentBlocks = new ArrayList&lt;&gt;();
        List&lt;String&gt; preBlocks = new ArrayList&lt;&gt;();
        List&lt;String&gt; taBlocks = new ArrayList&lt;&gt;();
        List&lt;String&gt; scriptBlocks = new ArrayList&lt;&gt;();
        List&lt;String&gt; styleBlocks = new ArrayList&lt;&gt;();
        List&lt;String&gt; eventBlocks = new ArrayList&lt;&gt;();
        List&lt;String&gt; skipBlocks = new ArrayList&lt;&gt;();
        List&lt;String&gt; lineBreakBlocks = new ArrayList&lt;&gt;();
        List&lt;List&lt;String&gt;&gt; userBlocks = new ArrayList&lt;&gt;();

<span class="nc bnc" id="L526" title="All 2 branches missed.">        // preserve blocks</span>
<span class="nc" id="L527">        html = preserveBlocks(html, preBlocks, taBlocks, scriptBlocks, styleBlocks, eventBlocks, condCommentBlocks,</span>
<span class="nc" id="L528">                skipBlocks, lineBreakBlocks, userBlocks);</span>
<span class="nc" id="L529"></span>
        // process pure html
        html = processHtml(html);
<span class="nc" id="L532"></span>
<span class="nc bnc" id="L533" title="All 2 branches missed.">        // process preserved blocks</span>
<span class="nc" id="L534">        processPreservedBlocks(preBlocks, taBlocks, scriptBlocks, styleBlocks, eventBlocks, condCommentBlocks,</span>
                skipBlocks, lineBreakBlocks, userBlocks);
<span class="nc" id="L536"></span>
<span class="nc" id="L537">        // put preserved blocks back</span>
        html = returnBlocks(html, preBlocks, taBlocks, scriptBlocks, styleBlocks, eventBlocks, condCommentBlocks,
<span class="nc" id="L539">                skipBlocks, lineBreakBlocks, userBlocks);</span>

        // calculate compressed statistics
        endStatistics(html);

        return html;
    }

    /**
     * Inits the statistics.
<span class="nc bnc" id="L549" title="All 2 branches missed.">     *</span>
<span class="nc" id="L550">     * @param html</span>
<span class="nc" id="L551">     *            the html</span>
     */
    protected void initStatistics(String html) {
<span class="nc" id="L554">        // create stats</span>
<span class="nc bnc" id="L555" title="All 2 branches missed.">        if (generateStatistics) {</span>
<span class="nc" id="L556">            statistics = new HtmlCompressorStatistics();</span>
            statistics.setTime((new Date()).getTime());
            statistics.getOriginalMetrics().setFilesize(html.length());
<span class="nc" id="L559"></span>
            // calculate number of empty chars
            Matcher matcher = emptyPattern.matcher(html);
            while (matcher.find()) {
                statistics.getOriginalMetrics().setEmptyChars(statistics.getOriginalMetrics().getEmptyChars() + 1);
            }
        } else {
            statistics = null;
        }
    }

    /**
     * End statistics.
     *
     * @param html
     *            the html
     */
    protected void endStatistics(String html) {
        // calculate compression time
        if (generateStatistics) {
            statistics.setTime((new Date()).getTime() - statistics.getTime());
            statistics.getCompressedMetrics().setFilesize(html.length());

            // calculate number of empty chars
            Matcher matcher = emptyPattern.matcher(html);
            while (matcher.find()) {
                statistics.getCompressedMetrics().setEmptyChars(statistics.getCompressedMetrics().getEmptyChars() + 1);
            }
        }
    }

    /**
     * Preserve blocks.
<span class="nc bnc" id="L592" title="All 2 branches missed.">     *</span>
<span class="nc bnc" id="L593" title="All 2 branches missed.">     * @param html</span>
<span class="nc" id="L594">     *            the html</span>
     * @param preBlocks
<span class="nc" id="L596">     *            the pre blocks</span>
<span class="nc" id="L597">     * @param taBlocks</span>
<span class="nc" id="L598">     *            the ta blocks</span>
<span class="nc bnc" id="L599" title="All 2 branches missed.">     * @param scriptBlocks</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">     *            the script blocks</span>
<span class="nc" id="L601">     * @param styleBlocks</span>
<span class="nc" id="L602">     *            the style blocks</span>
     * @param eventBlocks
     *            the event blocks
<span class="nc" id="L605">     * @param condCommentBlocks</span>
<span class="nc" id="L606">     *            the cond comment blocks</span>
<span class="nc" id="L607">     * @param skipBlocks</span>
     *            the skip blocks
     * @param lineBreakBlocks
     *            the line break blocks
     * @param userBlocks
<span class="nc" id="L612">     *            the user blocks</span>
<span class="nc" id="L613">     * @return the string</span>
<span class="nc" id="L614">     */</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">    protected String preserveBlocks(String html, List&lt;String&gt; preBlocks, List&lt;String&gt; taBlocks,</span>
<span class="nc bnc" id="L616" title="All 2 branches missed.">            List&lt;String&gt; scriptBlocks, List&lt;String&gt; styleBlocks, List&lt;String&gt; eventBlocks,</span>
<span class="nc" id="L617">            List&lt;String&gt; condCommentBlocks, List&lt;String&gt; skipBlocks, List&lt;String&gt; lineBreakBlocks,</span>
<span class="nc" id="L618">            List&lt;List&lt;String&gt;&gt; userBlocks) {</span>

        // preserve user blocks
<span class="nc" id="L621">        if (preservePatterns != null) {</span>
<span class="nc" id="L622">            for (int p = 0; p &lt; preservePatterns.size(); p++) {</span>
                List&lt;String&gt; userBlock = new ArrayList&lt;&gt;();

<span class="nc" id="L625">                Matcher matcher = preservePatterns.get(p).matcher(html);</span>
<span class="nc" id="L626">                int index = 0;</span>
<span class="nc" id="L627">                StringBuffer sb = new StringBuffer();</span>
<span class="nc" id="L628">                while (matcher.find()) {</span>
<span class="nc bnc" id="L629" title="All 2 branches missed.">                    if (matcher.group(0).trim().length() &gt; 0) {</span>
<span class="nc bnc" id="L630" title="All 2 branches missed.">                        userBlock.add(matcher.group(0));</span>
<span class="nc" id="L631">                        matcher.appendReplacement(sb, MessageFormat.format(TEMP_USER_BLOCK, p, index++));</span>
<span class="nc" id="L632">                    }</span>
<span class="nc" id="L633">                }</span>
                matcher.appendTail(sb);
                html = sb.toString();
<span class="nc" id="L636">                userBlocks.add(userBlock);</span>
<span class="nc" id="L637">            }</span>
        }

<span class="nc" id="L640">        // preserve &lt;!-- {{{ ---&gt;&lt;!-- }}} ---&gt; skip blocks</span>
<span class="nc" id="L641">        Matcher matcher = skipPattern.matcher(html);</span>
<span class="nc" id="L642">        int skipBlockIndex = 0;</span>
<span class="nc bnc" id="L643" title="All 2 branches missed.">        StringBuffer sb = new StringBuffer();</span>
<span class="nc bnc" id="L644" title="All 2 branches missed.">        while (matcher.find()) {</span>
<span class="nc" id="L645">            if (matcher.group(1).trim().length() &gt; 0) {</span>
<span class="nc" id="L646">                skipBlocks.add(matcher.group(1));</span>
                matcher.appendReplacement(sb, MessageFormat.format(TEMP_SKIP_BLOCK, skipBlockIndex++));
            }
<span class="nc" id="L649">        }</span>
<span class="nc" id="L650">        matcher.appendTail(sb);</span>
        html = sb.toString();
<span class="nc" id="L652"></span>
<span class="nc" id="L653">        // preserve conditional comments</span>
<span class="nc bnc" id="L654" title="All 2 branches missed.">        HtmlCompressor condCommentCompressor = createCompressorClone();</span>
<span class="nc bnc" id="L655" title="All 2 branches missed.">        matcher = condCommentPattern.matcher(html);</span>
<span class="nc" id="L656">        int index = 0;</span>
<span class="nc" id="L657">        sb = new StringBuffer();</span>
        while (matcher.find()) {
            if (matcher.group(2).trim().length() &gt; 0) {
<span class="nc" id="L660">                condCommentBlocks.add(matcher.group(1) + condCommentCompressor.compress(matcher.group(2))</span>
<span class="nc" id="L661">                        + matcher.group(3));</span>
                matcher.appendReplacement(sb, MessageFormat.format(TEMP_COND_COMMENT_BLOCK, index++));
            }
<span class="nc" id="L664">        }</span>
<span class="nc" id="L665">        matcher.appendTail(sb);</span>
<span class="nc" id="L666">        html = sb.toString();</span>
<span class="nc bnc" id="L667" title="All 2 branches missed."></span>
<span class="nc bnc" id="L668" title="All 2 branches missed.">        // preserve inline events</span>
<span class="nc" id="L669">        matcher = eventPattern1.matcher(html);</span>
<span class="nc" id="L670">        index = 0;</span>
        sb = new StringBuffer();
        while (matcher.find()) {
<span class="nc" id="L673">            if (matcher.group(2).trim().length() &gt; 0) {</span>
<span class="nc" id="L674">                eventBlocks.add(matcher.group(2));</span>
                matcher.appendReplacement(sb, &quot;$1&quot; + MessageFormat.format(TEMP_EVENT_BLOCK, index++) + &quot;$3&quot;);
            }
<span class="nc" id="L677">        }</span>
<span class="nc" id="L678">        matcher.appendTail(sb);</span>
<span class="nc" id="L679">        html = sb.toString();</span>
<span class="nc bnc" id="L680" title="All 2 branches missed."></span>
        matcher = eventPattern2.matcher(html);
<span class="nc bnc" id="L682" title="All 2 branches missed.">        sb = new StringBuffer();</span>
        while (matcher.find()) {
            if (matcher.group(2).trim().length() &gt; 0) {
<span class="nc" id="L685">                eventBlocks.add(matcher.group(2));</span>
<span class="nc" id="L686">                matcher.appendReplacement(sb, &quot;$1&quot; + MessageFormat.format(TEMP_EVENT_BLOCK, index++) + &quot;$3&quot;);</span>
<span class="nc bnc" id="L687" title="All 2 branches missed.">            }</span>
<span class="nc" id="L688">        }</span>
        matcher.appendTail(sb);
        html = sb.toString();
<span class="nc bnc" id="L691" title="All 6 branches missed."></span>
        // preserve PRE tags
<span class="nc" id="L693">        matcher = prePattern.matcher(html);</span>
<span class="nc" id="L694">        index = 0;</span>
<span class="nc bnc" id="L695" title="All 2 branches missed.">        sb = new StringBuffer();</span>
        while (matcher.find()) {
            if (matcher.group(2).trim().length() &gt; 0) {
                preBlocks.add(matcher.group(2));
<span class="nc" id="L699">                matcher.appendReplacement(sb, &quot;$1&quot; + MessageFormat.format(TEMP_PRE_BLOCK, index++) + &quot;$3&quot;);</span>
<span class="nc" id="L700">            }</span>
        }
        matcher.appendTail(sb);
<span class="nc" id="L703">        html = sb.toString();</span>

<span class="nc" id="L705">        // preserve SCRIPT tags</span>
<span class="nc" id="L706">        matcher = scriptPattern.matcher(html);</span>
        index = 0;
        sb = new StringBuffer();
<span class="nc" id="L709">        while (matcher.find()) {</span>
<span class="nc" id="L710">            // ignore empty scripts</span>
<span class="nc" id="L711">            if (matcher.group(2).trim().length() &gt; 0) {</span>
<span class="nc bnc" id="L712" title="All 2 branches missed."></span>
<span class="nc bnc" id="L713" title="All 2 branches missed.">                // check type</span>
<span class="nc" id="L714">                String type = &quot;&quot;;</span>
<span class="nc" id="L715">                Matcher typeMatcher = typeAttrPattern.matcher(matcher.group(1));</span>
                if (typeMatcher.find()) {
                    type = typeMatcher.group(2).toLowerCase();
<span class="nc" id="L718">                }</span>
<span class="nc" id="L719"></span>
                if (type.length() == 0 || &quot;text/javascript&quot;.equals(type) || &quot;application/javascript&quot;.equals(type)) {
                    // javascript block, preserve and compress with js compressor
<span class="nc" id="L722">                    scriptBlocks.add(matcher.group(2));</span>
<span class="nc" id="L723">                    matcher.appendReplacement(sb, &quot;$1&quot; + MessageFormat.format(TEMP_SCRIPT_BLOCK, index++) + &quot;$3&quot;);</span>
<span class="nc" id="L724">                } else if (&quot;text/x-jquery-tmpl&quot;.equals(type)) {</span>
<span class="nc bnc" id="L725" title="All 2 branches missed.">                    // jquery template, ignore so it gets compressed with the rest of html</span>
<span class="nc bnc" id="L726" title="All 2 branches missed.">                } else {</span>
<span class="nc" id="L727">                    // some custom script, preserve it inside &quot;skip blocks&quot; so it won't be compressed with js compressor</span>
<span class="nc" id="L728">                    skipBlocks.add(matcher.group(2));</span>
                    matcher.appendReplacement(sb, &quot;$1&quot; + MessageFormat.format(TEMP_SKIP_BLOCK, skipBlockIndex++) + &quot;$3&quot;);
                }
<span class="nc" id="L731"></span>
<span class="nc" id="L732">            }</span>
        }
        matcher.appendTail(sb);
<span class="nc bnc" id="L735" title="All 2 branches missed.">        html = sb.toString();</span>
<span class="nc" id="L736"></span>
<span class="nc" id="L737">        // preserve STYLE tags</span>
<span class="nc" id="L738">        matcher = stylePattern.matcher(html);</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">        index = 0;</span>
<span class="nc" id="L740">        sb = new StringBuffer();</span>
<span class="nc" id="L741">        while (matcher.find()) {</span>
            if (matcher.group(2).trim().length() &gt; 0) {
<span class="nc" id="L743">                styleBlocks.add(matcher.group(2));</span>
<span class="nc" id="L744">                matcher.appendReplacement(sb, &quot;$1&quot; + MessageFormat.format(TEMP_STYLE_BLOCK, index++) + &quot;$3&quot;);</span>
            }
        }
<span class="nc" id="L747">        matcher.appendTail(sb);</span>
        html = sb.toString();

        // preserve TEXTAREA tags
        matcher = taPattern.matcher(html);
        index = 0;
        sb = new StringBuffer();
        while (matcher.find()) {
            if (matcher.group(2).trim().length() &gt; 0) {
                taBlocks.add(matcher.group(2));
                matcher.appendReplacement(sb, &quot;$1&quot; + MessageFormat.format(TEMP_TEXT_AREA_BLOCK, index++) + &quot;$3&quot;);
            }
        }
        matcher.appendTail(sb);
        html = sb.toString();

        // preserve line breaks
        if (preserveLineBreaks) {
            matcher = lineBreakPattern.matcher(html);
            index = 0;
            sb = new StringBuffer();
            while (matcher.find()) {
                lineBreakBlocks.add(matcher.group(1));
                matcher.appendReplacement(sb, MessageFormat.format(TEMP_LINE_BREAK_BLOCK, index++));
            }
            matcher.appendTail(sb);
            html = sb.toString();
        }

        return html;
    }

    /**
     * Return blocks.
<span class="nc bnc" id="L781" title="All 2 branches missed.">     *</span>
<span class="nc" id="L782">     * @param html</span>
<span class="nc" id="L783">     *            the html</span>
<span class="nc bnc" id="L784" title="All 2 branches missed.">     * @param preBlocks</span>
<span class="nc" id="L785">     *            the pre blocks</span>
<span class="nc bnc" id="L786" title="All 2 branches missed.">     * @param taBlocks</span>
<span class="nc" id="L787">     *            the ta blocks</span>
     * @param scriptBlocks
<span class="nc" id="L789">     *            the script blocks</span>
<span class="nc" id="L790">     * @param styleBlocks</span>
<span class="nc" id="L791">     *            the style blocks</span>
     * @param eventBlocks
     *            the event blocks
     * @param condCommentBlocks
<span class="nc" id="L795">     *            the cond comment blocks</span>
<span class="nc" id="L796">     * @param skipBlocks</span>
<span class="nc bnc" id="L797" title="All 2 branches missed.">     *            the skip blocks</span>
<span class="nc" id="L798">     * @param lineBreakBlocks</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">     *            the line break blocks</span>
<span class="nc" id="L800">     * @param userBlocks</span>
     *            the user blocks
<span class="nc" id="L802">     * @return the string</span>
<span class="nc" id="L803">     */</span>
<span class="nc" id="L804">    protected String returnBlocks(String html, List&lt;String&gt; preBlocks, List&lt;String&gt; taBlocks,</span>
            List&lt;String&gt; scriptBlocks, List&lt;String&gt; styleBlocks, List&lt;String&gt; eventBlocks,
            List&lt;String&gt; condCommentBlocks, List&lt;String&gt; skipBlocks, List&lt;String&gt; lineBreakBlocks,
<span class="nc" id="L807">            List&lt;List&lt;String&gt;&gt; userBlocks) {</span>
<span class="nc" id="L808"></span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">        // put line breaks back</span>
<span class="nc" id="L810">        if (preserveLineBreaks) {</span>
<span class="nc bnc" id="L811" title="All 2 branches missed.">            Matcher matcher = tempLineBreakPattern.matcher(html);</span>
<span class="nc" id="L812">            StringBuffer sb = new StringBuffer();</span>
            while (matcher.find()) {
<span class="nc" id="L814">                int i = Integer.parseInt(matcher.group(1));</span>
<span class="nc" id="L815">                if (lineBreakBlocks.size() &gt; i) {</span>
<span class="nc" id="L816">                    matcher.appendReplacement(sb, lineBreakBlocks.get(i));</span>
                }
            }
<span class="nc" id="L819">            matcher.appendTail(sb);</span>
<span class="nc" id="L820">            html = sb.toString();</span>
<span class="nc bnc" id="L821" title="All 2 branches missed.">        }</span>
<span class="nc" id="L822"></span>
<span class="nc bnc" id="L823" title="All 2 branches missed.">        // put TEXTAREA blocks back</span>
<span class="nc" id="L824">        Matcher matcher = tempTextAreaPattern.matcher(html);</span>
        StringBuffer sb = new StringBuffer();
<span class="nc" id="L826">        while (matcher.find()) {</span>
<span class="nc" id="L827">            int i = Integer.parseInt(matcher.group(1));</span>
<span class="nc" id="L828">            if (taBlocks.size() &gt; i) {</span>
                matcher.appendReplacement(sb, Matcher.quoteReplacement(taBlocks.get(i)));
            }
<span class="nc" id="L831">        }</span>
<span class="nc" id="L832">        matcher.appendTail(sb);</span>
<span class="nc bnc" id="L833" title="All 2 branches missed.">        html = sb.toString();</span>
<span class="nc" id="L834"></span>
<span class="nc bnc" id="L835" title="All 2 branches missed.">        // put STYLE blocks back</span>
<span class="nc" id="L836">        matcher = tempStylePattern.matcher(html);</span>
        sb = new StringBuffer();
<span class="nc" id="L838">        while (matcher.find()) {</span>
<span class="nc" id="L839">            int i = Integer.parseInt(matcher.group(1));</span>
<span class="nc" id="L840">            if (styleBlocks.size() &gt; i) {</span>
                matcher.appendReplacement(sb, Matcher.quoteReplacement(styleBlocks.get(i)));
            }
<span class="nc" id="L843">        }</span>
<span class="nc" id="L844">        matcher.appendTail(sb);</span>
<span class="nc bnc" id="L845" title="All 2 branches missed.">        html = sb.toString();</span>
<span class="nc" id="L846"></span>
<span class="nc bnc" id="L847" title="All 2 branches missed.">        // put SCRIPT blocks back</span>
<span class="nc" id="L848">        matcher = tempScriptPattern.matcher(html);</span>
        sb = new StringBuffer();
<span class="nc" id="L850">        while (matcher.find()) {</span>
<span class="nc" id="L851">            int i = Integer.parseInt(matcher.group(1));</span>
<span class="nc" id="L852">            if (scriptBlocks.size() &gt; i) {</span>
                matcher.appendReplacement(sb, Matcher.quoteReplacement(scriptBlocks.get(i)));
            }
<span class="nc" id="L855">        }</span>
<span class="nc" id="L856">        matcher.appendTail(sb);</span>
<span class="nc bnc" id="L857" title="All 2 branches missed.">        html = sb.toString();</span>
<span class="nc" id="L858"></span>
<span class="nc bnc" id="L859" title="All 2 branches missed.">        // put PRE blocks back</span>
<span class="nc" id="L860">        matcher = tempPrePattern.matcher(html);</span>
        sb = new StringBuffer();
<span class="nc" id="L862">        while (matcher.find()) {</span>
<span class="nc" id="L863">            int i = Integer.parseInt(matcher.group(1));</span>
<span class="nc" id="L864">            if (preBlocks.size() &gt; i) {</span>
                matcher.appendReplacement(sb, Matcher.quoteReplacement(preBlocks.get(i)));
            }
<span class="nc" id="L867">        }</span>
<span class="nc" id="L868">        matcher.appendTail(sb);</span>
<span class="nc bnc" id="L869" title="All 2 branches missed.">        html = sb.toString();</span>
<span class="nc" id="L870"></span>
<span class="nc bnc" id="L871" title="All 2 branches missed.">        // put event blocks back</span>
<span class="nc" id="L872">        matcher = tempEventPattern.matcher(html);</span>
        sb = new StringBuffer();
<span class="nc" id="L874">        while (matcher.find()) {</span>
<span class="nc" id="L875">            int i = Integer.parseInt(matcher.group(1));</span>
<span class="nc" id="L876">            if (eventBlocks.size() &gt; i) {</span>
                matcher.appendReplacement(sb, Matcher.quoteReplacement(eventBlocks.get(i)));
            }
<span class="nc bnc" id="L879" title="All 2 branches missed.">        }</span>
<span class="nc bnc" id="L880" title="All 2 branches missed.">        matcher.appendTail(sb);</span>
<span class="nc" id="L881">        html = sb.toString();</span>
<span class="nc" id="L882"></span>
<span class="nc" id="L883">        // put conditional comments back</span>
<span class="nc bnc" id="L884" title="All 2 branches missed.">        matcher = tempCondCommentPattern.matcher(html);</span>
<span class="nc" id="L885">        sb = new StringBuffer();</span>
<span class="nc bnc" id="L886" title="All 4 branches missed.">        while (matcher.find()) {</span>
<span class="nc" id="L887">            int i = Integer.parseInt(matcher.group(1));</span>
            if (condCommentBlocks.size() &gt; i) {
<span class="nc" id="L889">                matcher.appendReplacement(sb, Matcher.quoteReplacement(condCommentBlocks.get(i)));</span>
<span class="nc" id="L890">            }</span>
<span class="nc" id="L891">        }</span>
        matcher.appendTail(sb);
        html = sb.toString();

<span class="nc" id="L895">        // put skip blocks back</span>
        matcher = tempSkipPattern.matcher(html);
        sb = new StringBuffer();
        while (matcher.find()) {
            int i = Integer.parseInt(matcher.group(1));
            if (skipBlocks.size() &gt; i) {
                matcher.appendReplacement(sb, Matcher.quoteReplacement(skipBlocks.get(i)));
            }
        }
        matcher.appendTail(sb);
        html = sb.toString();

        // put user blocks back
<span class="nc" id="L908">        if (preservePatterns != null) {</span>
            for (int p = preservePatterns.size() - 1; p &gt;= 0; p--) {
                Pattern tempUserPattern = Pattern.compile(&quot;%%%~COMPRESS~USER&quot; + p + &quot;~(\\d+?)~%%%&quot;);
<span class="nc" id="L911">                matcher = tempUserPattern.matcher(html);</span>
                sb = new StringBuffer();
                while (matcher.find()) {
<span class="nc" id="L914">                    int i = Integer.parseInt(matcher.group(1));</span>
                    if (userBlocks.size() &gt; p &amp;&amp; userBlocks.get(p).size() &gt; i) {
                        matcher.appendReplacement(sb, Matcher.quoteReplacement(userBlocks.get(p).get(i)));
<span class="nc" id="L917">                    }</span>
                }
                matcher.appendTail(sb);
<span class="nc" id="L920">                html = sb.toString();</span>
            }
        }
<span class="nc" id="L923"></span>
        return html;
    }
<span class="nc" id="L926"></span>
    /**
     * Process html.
<span class="nc" id="L929">     *</span>
     * @param html
     *            the html
<span class="nc" id="L932">     * @return the string</span>
     */
    protected String processHtml(String html) {
<span class="nc" id="L935"></span>
        // remove comments
        html = removeComments(html);
<span class="nc" id="L938"></span>
        // simplify doctype
        html = simpleDoctype(html);
<span class="nc" id="L941"></span>
        // remove script attributes
        html = removeScriptAttributes(html);
<span class="nc" id="L944"></span>
        // remove style attributes
        html = removeStyleAttributes(html);
<span class="nc" id="L947"></span>
        // remove link attributes
        html = removeLinkAttributes(html);
<span class="nc" id="L950"></span>
        // remove form attributes
<span class="nc" id="L952">        html = removeFormAttributes(html);</span>

        // remove input attributes
        html = removeInputAttributes(html);

        // simplify boolean attributes
        html = simpleBooleanAttributes(html);

        // remove http from attributes
        html = removeHttpProtocol(html);

        // remove https from attributes
<span class="nc bnc" id="L964" title="All 2 branches missed.">        html = removeHttpsProtocol(html);</span>

<span class="nc bnc" id="L966" title="All 2 branches missed.">        // remove inter-tag spaces</span>
<span class="nc" id="L967">        html = removeIntertagSpaces(html);</span>
<span class="nc bnc" id="L968" title="All 2 branches missed."></span>
<span class="nc" id="L969">        // remove multi whitespace characters</span>
        html = removeMultiSpaces(html);
<span class="nc bnc" id="L971" title="All 2 branches missed."></span>
<span class="nc" id="L972">        // remove spaces around equals sign and ending spaces</span>
        html = removeSpacesInsideTags(html);
<span class="nc" id="L974"></span>
        // remove quotes from tag attributes
        html = removeQuotesInsideTags(html);

<span class="nc" id="L978">        // remove surrounding spaces</span>
<span class="nc" id="L979">        html = removeSurroundingSpaces(html);</span>
<span class="nc bnc" id="L980" title="All 2 branches missed."></span>
<span class="nc" id="L981">        return html.trim();</span>
    }
<span class="nc" id="L983"></span>
<span class="nc" id="L984">    /**</span>
     * Removes the surrounding spaces.
     *
<span class="nc" id="L987">     * @param html</span>
     *            the html
     * @return the string
     */
    protected String removeSurroundingSpaces(String html) {
        // remove spaces around provided tags
        if (removeSurroundingSpaces != null) {
            Pattern pattern;
            if (removeSurroundingSpaces.equalsIgnoreCase(BLOCK_TAGS_MIN)) {
                pattern = surroundingSpacesMinPattern;
            } else if (removeSurroundingSpaces.equalsIgnoreCase(BLOCK_TAGS_MAX)) {
                pattern = surroundingSpacesMaxPattern;
<span class="nc bnc" id="L999" title="All 2 branches missed.">            }</span>
<span class="nc" id="L1000">            if (removeSurroundingSpaces.equalsIgnoreCase(ALL_TAGS)) {</span>
<span class="nc" id="L1001">                pattern = surroundingSpacesAllPattern;</span>
<span class="nc bnc" id="L1002" title="All 2 branches missed.">            } else {</span>
                pattern = Pattern.compile(&quot;\\s*(&lt;/?(?:&quot; + removeSurroundingSpaces.replaceAll(&quot;,&quot;, &quot;|&quot;)
<span class="nc bnc" id="L1004" title="All 2 branches missed.">                        + &quot;)(?:&gt;|[\\s/][^&gt;]*&gt;))\\s*&quot;, Pattern.DOTALL | Pattern.CASE_INSENSITIVE);</span>
<span class="nc" id="L1005">            }</span>

<span class="nc" id="L1007">            Matcher matcher = pattern.matcher(html);</span>
            StringBuffer sb = new StringBuffer();
            while (matcher.find()) {
<span class="nc" id="L1010">                matcher.appendReplacement(sb, &quot;$1&quot;);</span>
<span class="nc" id="L1011">            }</span>
            matcher.appendTail(sb);
            html = sb.toString();
<span class="nc" id="L1014"></span>
        }
        return html;
    }

    /**
     * Removes the quotes inside tags.
     *
     * @param html
     *            the html
     * @return the string
     */
<span class="nc" id="L1026">    protected String removeQuotesInsideTags(String html) {</span>
        // remove quotes from tag attributes
        if (removeQuotes) {
            Matcher matcher = tagQuotePattern.matcher(html);
<span class="nc" id="L1030">            StringBuffer sb = new StringBuffer();</span>
<span class="nc" id="L1031">            while (matcher.find()) {</span>
<span class="nc bnc" id="L1032" title="All 2 branches missed.">                // if quoted attribute is followed by &quot;/&quot; add extra space</span>
                if (matcher.group(3).trim().length() == 0) {
<span class="nc bnc" id="L1034" title="All 4 branches missed.">                    matcher.appendReplacement(sb, &quot;=$2&quot;);</span>
<span class="nc" id="L1035">                } else {</span>
                    matcher.appendReplacement(sb, &quot;=$2 $3&quot;);
<span class="nc" id="L1037">                }</span>
            }
            matcher.appendTail(sb);
<span class="nc" id="L1040">            html = sb.toString();</span>
<span class="nc" id="L1041"></span>
        }
<span class="nc" id="L1043">        return html;</span>
    }

    /**
     * Removes the spaces inside tags.
     *
     * @param html
     *            the html
     * @return the string
     */
    protected String removeSpacesInsideTags(String html) {
        // remove spaces around equals sign inside tags
<span class="nc bnc" id="L1055" title="All 2 branches missed.">        html = tagPropertyPattern.matcher(html).replaceAll(&quot;$1=&quot;);</span>
<span class="nc" id="L1056"></span>
        // remove ending spaces inside tags
<span class="nc" id="L1058">        // html = tagEndSpacePattern.matcher(html).replaceAll(&quot;$1$2&quot;);</span>
        Matcher matcher = tagEndSpacePattern.matcher(html);
        StringBuffer sb = new StringBuffer();
        while (matcher.find()) {
            // keep space if attribute value is unquoted before trailing slash
            if (matcher.group(2).startsWith(&quot;/&quot;) &amp;&amp; tagLastUnquotedValuePattern.matcher(matcher.group(1)).find()) {
                matcher.appendReplacement(sb, &quot;$1 $2&quot;);
            } else {
                matcher.appendReplacement(sb, &quot;$1$2&quot;);
            }
        }
        matcher.appendTail(sb);
<span class="nc bnc" id="L1070" title="All 2 branches missed.">        html = sb.toString();</span>
<span class="nc" id="L1071"></span>
<span class="nc" id="L1072">        return html;</span>
<span class="nc" id="L1073">    }</span>
<span class="nc" id="L1074"></span>
    /**
<span class="nc" id="L1076">     * Removes the multi spaces.</span>
     *
     * @param html
     *            the html
     * @return the string
     */
    protected String removeMultiSpaces(String html) {
        // collapse multiple spaces
        if (removeMultiSpaces) {
            html = multispacePattern.matcher(html).replaceAll(&quot; &quot;);
        }
        return html;
<span class="nc bnc" id="L1088" title="All 2 branches missed.">    }</span>
<span class="nc" id="L1089"></span>
    /**
<span class="nc" id="L1091">     * Removes the intertag spaces.</span>
     *
     * @param html
     *            the html
     * @return the string
     */
    protected String removeIntertagSpaces(String html) {
        // remove inter-tag spaces
        if (removeIntertagSpaces) {
            html = intertagPattern_TagTag.matcher(html).replaceAll(&quot;&gt;&lt;&quot;);
            html = intertagPattern_TagCustom.matcher(html).replaceAll(&quot;&gt;%%%~&quot;);
            html = intertagPattern_CustomTag.matcher(html).replaceAll(&quot;~%%%&lt;&quot;);
<span class="nc bnc" id="L1103" title="All 2 branches missed.">            html = intertagPattern_CustomCustom.matcher(html).replaceAll(&quot;~%%%%%%~&quot;);</span>
<span class="nc" id="L1104">        }</span>
        return html;
<span class="nc" id="L1106">    }</span>

    /**
     * Removes the comments.
     *
     * @param html
     *            the html
     * @return the string
     */
    protected String removeComments(String html) {
        // remove comments
        if (removeComments) {
<span class="nc bnc" id="L1118" title="All 2 branches missed.">            html = commentPattern.matcher(html).replaceAll(&quot;&quot;);</span>
        }
<span class="nc" id="L1120">        return html;</span>
    }

<span class="nc" id="L1123">    /**</span>
     * Simple doctype.
<span class="nc" id="L1125">     *</span>
     * @param html
     *            the html
     * @return the string
     */
    protected String simpleDoctype(String html) {
        // simplify doctype
        if (simpleDoctype) {
            html = doctypePattern.matcher(html).replaceAll(&quot;&lt;!DOCTYPE html&gt;&quot;);
        }
        return html;
    }
<span class="nc bnc" id="L1137" title="All 2 branches missed."></span>
<span class="nc" id="L1138">    /**</span>
     * Removes the script attributes.
<span class="nc" id="L1140">     *</span>
     * @param html
     *            the html
     * @return the string
     */
    protected String removeScriptAttributes(String html) {

        if (removeScriptAttributes) {
            // remove type from script tags
            html = jsTypeAttrPattern.matcher(html).replaceAll(&quot;$1$3&quot;);

            // remove language from script tags
<span class="nc bnc" id="L1152" title="All 2 branches missed.">            html = jsLangAttrPattern.matcher(html).replaceAll(&quot;$1$3&quot;);</span>
<span class="nc" id="L1153">        }</span>
<span class="nc" id="L1154">        return html;</span>
<span class="nc bnc" id="L1155" title="All 2 branches missed.">    }</span>

<span class="nc bnc" id="L1157" title="All 2 branches missed.">    /**</span>
<span class="nc" id="L1158">     * Removes the style attributes.</span>
     *
<span class="nc" id="L1160">     * @param html</span>
     *            the html
     * @return the string
<span class="nc" id="L1163">     */</span>
<span class="nc" id="L1164">    protected String removeStyleAttributes(String html) {</span>
        // remove type from style tags
<span class="nc" id="L1166">        if (removeStyleAttributes) {</span>
            html = styleTypeAttrPattern.matcher(html).replaceAll(&quot;$1$3&quot;);
        }
        return html;
    }

    /**
     * Removes the link attributes.
     *
     * @param html
     *            the html
     * @return the string
<span class="nc bnc" id="L1178" title="All 2 branches missed.">     */</span>
<span class="nc" id="L1179">    protected String removeLinkAttributes(String html) {</span>
        // remove type from link tags with rel=stylesheet
<span class="nc" id="L1181">        if (removeLinkAttributes) {</span>
            Matcher matcher = linkTypeAttrPattern.matcher(html);
            StringBuffer sb = new StringBuffer();
            while (matcher.find()) {
                // if rel=stylesheet
                if (linkRelAttrPattern.matcher(matcher.group(0)).matches()) {
                    matcher.appendReplacement(sb, &quot;$1$3&quot;);
                } else {
                    matcher.appendReplacement(sb, &quot;$0&quot;);
                }
            }
            matcher.appendTail(sb);
<span class="nc bnc" id="L1193" title="All 2 branches missed.">            html = sb.toString();</span>
<span class="nc" id="L1194">        }</span>
        return html;
<span class="nc" id="L1196">    }</span>

    /**
     * Removes the form attributes.
     *
     * @param html
     *            the html
     * @return the string
     */
    protected String removeFormAttributes(String html) {
        // remove method from form tags
        if (removeFormAttributes) {
<span class="nc bnc" id="L1208" title="All 2 branches missed.">            html = formMethodAttrPattern.matcher(html).replaceAll(&quot;$1$3&quot;);</span>
<span class="nc" id="L1209">        }</span>
        return html;
<span class="nc" id="L1211">    }</span>

    /**
     * Removes the input attributes.
     *
     * @param html
     *            the html
     * @return the string
     */
    protected String removeInputAttributes(String html) {
        // remove type from input tags
        if (removeInputAttributes) {
<span class="nc bnc" id="L1223" title="All 2 branches missed.">            html = inputTypeAttrPattern.matcher(html).replaceAll(&quot;$1$3&quot;);</span>
<span class="nc" id="L1224">        }</span>
<span class="nc" id="L1225">        return html;</span>
<span class="nc bnc" id="L1226" title="All 2 branches missed.">    }</span>

<span class="nc bnc" id="L1228" title="All 2 branches missed.">    /**</span>
<span class="nc" id="L1229">     * Simple boolean attributes.</span>
     *
<span class="nc" id="L1231">     * @param html</span>
     *            the html
     * @return the string
<span class="nc" id="L1234">     */</span>
<span class="nc" id="L1235">    protected String simpleBooleanAttributes(String html) {</span>
        // simplify boolean attributes
<span class="nc" id="L1237">        if (simpleBooleanAttributes) {</span>
            html = booleanAttrPattern.matcher(html).replaceAll(&quot;$1$2$4&quot;);
        }
        return html;
    }

    /**
     * Removes the http protocol.
     *
     * @param html
     *            the html
     * @return the string
<span class="nc bnc" id="L1249" title="All 2 branches missed.">     */</span>
<span class="nc" id="L1250">    protected String removeHttpProtocol(String html) {</span>
<span class="nc" id="L1251">        // remove http protocol from tag attributes</span>
<span class="nc bnc" id="L1252" title="All 2 branches missed.">        if (removeHttpProtocol) {</span>
            Matcher matcher = httpProtocolPattern.matcher(html);
<span class="nc bnc" id="L1254" title="All 2 branches missed.">            StringBuffer sb = new StringBuffer();</span>
<span class="nc" id="L1255">            while (matcher.find()) {</span>
                // if rel!=external
<span class="nc" id="L1257">                if (!relExternalPattern.matcher(matcher.group(0)).matches()) {</span>
                    matcher.appendReplacement(sb, &quot;$1$2&quot;);
                } else {
<span class="nc" id="L1260">                    matcher.appendReplacement(sb, &quot;$0&quot;);</span>
<span class="nc" id="L1261">                }</span>
            }
<span class="nc" id="L1263">            matcher.appendTail(sb);</span>
            html = sb.toString();
        }
        return html;
    }

    /**
     * Removes the https protocol.
     *
     * @param html
     *            the html
     * @return the string
     */
    protected String removeHttpsProtocol(String html) {
        // remove https protocol from tag attributes
        if (removeHttpsProtocol) {
            Matcher matcher = httpsProtocolPattern.matcher(html);
            StringBuffer sb = new StringBuffer();
            while (matcher.find()) {
                // if rel!=external
                if (!relExternalPattern.matcher(matcher.group(0)).matches()) {
                    matcher.appendReplacement(sb, &quot;$1$2&quot;);
                } else {
                    matcher.appendReplacement(sb, &quot;$0&quot;);
                }
            }
            matcher.appendTail(sb);
            html = sb.toString();
<span class="nc" id="L1291">        }</span>
<span class="nc" id="L1292">        return html;</span>
<span class="nc" id="L1293">    }</span>
<span class="nc" id="L1294"></span>
<span class="nc" id="L1295">    /**</span>
<span class="nc" id="L1296">     * Process preserved blocks.</span>
<span class="nc" id="L1297">     *</span>
<span class="nc" id="L1298">     * @param preBlocks</span>
<span class="nc" id="L1299">     *            the pre blocks</span>
<span class="nc" id="L1300">     * @param taBlocks</span>
     *            the ta blocks
     * @param scriptBlocks
     *            the script blocks
     * @param styleBlocks
     *            the style blocks
     * @param eventBlocks
     *            the event blocks
     * @param condCommentBlocks
<span class="nc bnc" id="L1309" title="All 2 branches missed.">     *            the cond comment blocks</span>
<span class="nc bnc" id="L1310" title="All 2 branches missed.">     * @param skipBlocks</span>
<span class="nc" id="L1311">     *            the skip blocks</span>
<span class="nc" id="L1312">     * @param lineBreakBlocks</span>
     *            the line break blocks
<span class="nc" id="L1314">     * @param userBlocks</span>
     *            the user blocks
     */
    protected void processPreservedBlocks(List&lt;String&gt; preBlocks, List&lt;String&gt; taBlocks, List&lt;String&gt; scriptBlocks,
            List&lt;String&gt; styleBlocks, List&lt;String&gt; eventBlocks, List&lt;String&gt; condCommentBlocks,
            List&lt;String&gt; skipBlocks, List&lt;String&gt; lineBreakBlocks, List&lt;List&lt;String&gt;&gt; userBlocks) {
        processPreBlocks(preBlocks);
        processTextAreaBlocks(taBlocks);
        processScriptBlocks(scriptBlocks);
<span class="nc bnc" id="L1323" title="All 2 branches missed.">        processStyleBlocks(styleBlocks);</span>
<span class="nc bnc" id="L1324" title="All 2 branches missed.">        processEventBlocks(eventBlocks);</span>
<span class="nc" id="L1325">        processCondCommentBlocks(condCommentBlocks);</span>
<span class="nc" id="L1326">        processSkipBlocks(skipBlocks);</span>
        processUserBlocks(userBlocks);
<span class="nc" id="L1328">        processLineBreakBlocks(lineBreakBlocks);</span>
    }

    /**
     * Process pre blocks.
     *
     * @param preBlocks
     *            the pre blocks
     */
<span class="nc bnc" id="L1337" title="All 2 branches missed.">    protected void processPreBlocks(List&lt;String&gt; preBlocks) {</span>
<span class="nc bnc" id="L1338" title="All 2 branches missed.">        if (generateStatistics) {</span>
<span class="nc" id="L1339">            for (String block : preBlocks) {</span>
<span class="nc" id="L1340">                statistics.setPreservedSize(statistics.getPreservedSize() + block.length());</span>
            }
<span class="nc" id="L1342">        }</span>
    }

    /**
     * Process text area blocks.
     *
     * @param taBlocks
     *            the ta blocks
     */
<span class="nc bnc" id="L1351" title="All 2 branches missed.">    protected void processTextAreaBlocks(List&lt;String&gt; taBlocks) {</span>
<span class="nc bnc" id="L1352" title="All 2 branches missed.">        if (generateStatistics) {</span>
<span class="nc" id="L1353">            for (String block : taBlocks) {</span>
<span class="nc" id="L1354">                statistics.setPreservedSize(statistics.getPreservedSize() + block.length());</span>
            }
<span class="nc" id="L1356">        }</span>
    }

    /**
     * Process cond comment blocks.
     *
     * @param condCommentBlocks
     *            the cond comment blocks
     */
<span class="nc bnc" id="L1365" title="All 2 branches missed.">    protected void processCondCommentBlocks(List&lt;String&gt; condCommentBlocks) {</span>
<span class="nc bnc" id="L1366" title="All 2 branches missed.">        if (generateStatistics) {</span>
<span class="nc" id="L1367">            for (String block : condCommentBlocks) {</span>
<span class="nc" id="L1368">                statistics.setPreservedSize(statistics.getPreservedSize() + block.length());</span>
            }
<span class="nc" id="L1370">        }</span>
    }

    /**
     * Process skip blocks.
     *
     * @param skipBlocks
     *            the skip blocks
     */
<span class="nc bnc" id="L1379" title="All 2 branches missed.">    protected void processSkipBlocks(List&lt;String&gt; skipBlocks) {</span>
<span class="nc bnc" id="L1380" title="All 2 branches missed.">        if (generateStatistics) {</span>
<span class="nc bnc" id="L1381" title="All 2 branches missed.">            for (String block : skipBlocks) {</span>
<span class="nc" id="L1382">                statistics.setPreservedSize(statistics.getPreservedSize() + block.length());</span>
<span class="nc" id="L1383">            }</span>
<span class="nc" id="L1384">        }</span>
    }
<span class="nc" id="L1386"></span>
    /**
     * Process line break blocks.
     *
     * @param lineBreakBlocks
     *            the line break blocks
     */
    protected void processLineBreakBlocks(List&lt;String&gt; lineBreakBlocks) {
        if (generateStatistics) {
            for (String block : lineBreakBlocks) {
<span class="nc bnc" id="L1396" title="All 2 branches missed.">                statistics.setPreservedSize(statistics.getPreservedSize() + block.length());</span>
<span class="nc bnc" id="L1397" title="All 2 branches missed.">            }</span>
<span class="nc" id="L1398">        }</span>
<span class="nc" id="L1399">    }</span>
<span class="nc" id="L1400"></span>
    /**
     * Process user blocks.
<span class="nc bnc" id="L1403" title="All 2 branches missed.">     *</span>
<span class="nc bnc" id="L1404" title="All 2 branches missed.">     * @param userBlocks</span>
<span class="nc" id="L1405">     *            the user blocks</span>
     */
<span class="nc bnc" id="L1407" title="All 2 branches missed.">    protected void processUserBlocks(List&lt;List&lt;String&gt;&gt; userBlocks) {</span>
<span class="nc bnc" id="L1408" title="All 2 branches missed.">        if (generateStatistics) {</span>
<span class="nc" id="L1409">            for (List&lt;String&gt; blockList : userBlocks) {</span>
<span class="nc" id="L1410">                for (String block : blockList) {</span>
                    statistics.setPreservedSize(statistics.getPreservedSize() + block.length());
                }
<span class="nc bnc" id="L1413" title="All 2 branches missed.">            }</span>
<span class="nc bnc" id="L1414" title="All 2 branches missed.">        }</span>
<span class="nc" id="L1415">    }</span>
<span class="nc" id="L1416"></span>
<span class="nc" id="L1417">    /**</span>
     * Process event blocks.
<span class="nc" id="L1419">     *</span>
     * @param eventBlocks
     *            the event blocks
     */
    protected void processEventBlocks(List&lt;String&gt; eventBlocks) {

        if (generateStatistics) {
            for (String block : eventBlocks) {
                statistics.getOriginalMetrics().setInlineEventSize(
                        statistics.getOriginalMetrics().getInlineEventSize() + block.length());
            }
<span class="nc" id="L1430">        }</span>

<span class="nc" id="L1432">        if (removeJavaScriptProtocol) {</span>
<span class="nc bnc" id="L1433" title="All 2 branches missed.">            for (int i = 0; i &lt; eventBlocks.size(); i++) {</span>
<span class="nc" id="L1434">                eventBlocks.set(i, removeJavaScriptProtocol(eventBlocks.get(i)));</span>
            }
        } else if (generateStatistics) {
<span class="nc bnc" id="L1437" title="All 2 branches missed.">            for (String block : eventBlocks) {</span>
<span class="nc" id="L1438">                statistics.setPreservedSize(statistics.getPreservedSize() + block.length());</span>
            }
        }
<span class="nc" id="L1441"></span>
        if (generateStatistics) {
            for (String block : eventBlocks) {
                statistics.getCompressedMetrics().setInlineEventSize(
                        statistics.getCompressedMetrics().getInlineEventSize() + block.length());
            }
        }
    }

    /**
     * Removes the java script protocol.
<span class="nc bnc" id="L1452" title="All 2 branches missed.">     *</span>
<span class="nc bnc" id="L1453" title="All 2 branches missed.">     * @param source</span>
<span class="nc" id="L1454">     *            the source</span>
<span class="nc" id="L1455">     * @return the string</span>
<span class="nc" id="L1456">     */</span>
    protected String removeJavaScriptProtocol(String source) {
        // remove javascript: from inline events
<span class="nc bnc" id="L1459" title="All 2 branches missed.">        String result = source;</span>
<span class="nc bnc" id="L1460" title="All 2 branches missed."></span>
<span class="nc" id="L1461">        Matcher matcher = eventJsProtocolPattern.matcher(source);</span>
        if (matcher.matches()) {
<span class="nc bnc" id="L1463" title="All 2 branches missed.">            result = matcher.replaceFirst(&quot;$1&quot;);</span>
<span class="nc bnc" id="L1464" title="All 2 branches missed.">        }</span>
<span class="nc" id="L1465"></span>
<span class="nc" id="L1466">        if (generateStatistics) {</span>
            statistics.setPreservedSize(statistics.getPreservedSize() + result.length());
        }
<span class="nc bnc" id="L1469" title="All 2 branches missed."></span>
<span class="nc bnc" id="L1470" title="All 2 branches missed.">        return result;</span>
<span class="nc" id="L1471">    }</span>
<span class="nc" id="L1472"></span>
<span class="nc" id="L1473">    /**</span>
     * Process script blocks.
<span class="nc" id="L1475">     *</span>
     * @param scriptBlocks
     *            the script blocks
     */
    protected void processScriptBlocks(List&lt;String&gt; scriptBlocks) {

        if (generateStatistics) {
            for (String block : scriptBlocks) {
                statistics.getOriginalMetrics().setInlineScriptSize(
                        statistics.getOriginalMetrics().getInlineScriptSize() + block.length());
<span class="nc bnc" id="L1485" title="All 2 branches missed.">            }</span>
<span class="nc bnc" id="L1486" title="All 2 branches missed.">        }</span>
<span class="nc" id="L1487"></span>
<span class="nc" id="L1488">        if (compressJavaScript) {</span>
<span class="nc" id="L1489">            for (int i = 0; i &lt; scriptBlocks.size(); i++) {</span>
                scriptBlocks.set(i, compressJavaScript(scriptBlocks.get(i)));
            }
<span class="nc bnc" id="L1492" title="All 2 branches missed.">        } else if (generateStatistics) {</span>
<span class="nc bnc" id="L1493" title="All 2 branches missed.">            for (String block : scriptBlocks) {</span>
<span class="nc" id="L1494">                statistics.setPreservedSize(statistics.getPreservedSize() + block.length());</span>
            }
<span class="nc bnc" id="L1496" title="All 2 branches missed.">        }</span>
<span class="nc bnc" id="L1497" title="All 2 branches missed."></span>
<span class="nc" id="L1498">        if (generateStatistics) {</span>
<span class="nc" id="L1499">            for (String block : scriptBlocks) {</span>
                statistics.getCompressedMetrics().setInlineScriptSize(
                        statistics.getCompressedMetrics().getInlineScriptSize() + block.length());
<span class="nc bnc" id="L1502" title="All 2 branches missed.">            }</span>
<span class="nc bnc" id="L1503" title="All 2 branches missed.">        }</span>
<span class="nc" id="L1504">    }</span>
<span class="nc" id="L1505"></span>
<span class="nc" id="L1506">    /**</span>
     * Process style blocks.
<span class="nc" id="L1508">     *</span>
     * @param styleBlocks
     *            the style blocks
     */
    protected void processStyleBlocks(List&lt;String&gt; styleBlocks) {

        if (generateStatistics) {
            for (String block : styleBlocks) {
                statistics.getOriginalMetrics().setInlineStyleSize(
                        statistics.getOriginalMetrics().getInlineStyleSize() + block.length());
            }
        }
<span class="nc bnc" id="L1520" title="All 2 branches missed."></span>
<span class="nc" id="L1521">        if (compressCss) {</span>
<span class="nc" id="L1522">            for (int i = 0; i &lt; styleBlocks.size(); i++) {</span>
<span class="nc" id="L1523">                styleBlocks.set(i, compressCssStyles(styleBlocks.get(i)));</span>
<span class="nc" id="L1524">            }</span>
<span class="nc" id="L1525">        } else if (generateStatistics) {</span>
            for (String block : styleBlocks) {
<span class="nc bnc" id="L1527" title="All 2 branches missed.">                statistics.setPreservedSize(statistics.getPreservedSize() + block.length());</span>
<span class="nc" id="L1528">            }</span>
        }

<span class="nc" id="L1531">        if (generateStatistics) {</span>
            for (String block : styleBlocks) {
                statistics.getCompressedMetrics().setInlineStyleSize(
                        statistics.getCompressedMetrics().getInlineStyleSize() + block.length());
<span class="nc" id="L1535">            }</span>
<span class="nc" id="L1536">        }</span>
<span class="nc bnc" id="L1537" title="All 2 branches missed.">    }</span>
<span class="nc" id="L1538"></span>
<span class="nc" id="L1539">    /**</span>
     * Compress java script.
     *
<span class="nc" id="L1542">     * @param source</span>
     *            the source
<span class="nc bnc" id="L1544" title="All 2 branches missed.">     * @return the string</span>
<span class="nc" id="L1545">     */</span>
    protected String compressJavaScript(String source) {

<span class="nc" id="L1548">        // set default javascript compressor</span>
        if (javaScriptCompressor == null) {
            YuiJavaScriptCompressor yuiJsCompressor = new YuiJavaScriptCompressor();
            yuiJsCompressor.setNoMunge(yuiJsNoMunge);
            yuiJsCompressor.setPreserveAllSemiColons(yuiJsPreserveAllSemiColons);
            yuiJsCompressor.setDisableOptimizations(yuiJsDisableOptimizations);
            yuiJsCompressor.setLineBreak(yuiJsLineBreak);

            if (yuiErrorReporter != null) {
                yuiJsCompressor.setErrorReporter(yuiErrorReporter);
            }

            javaScriptCompressor = yuiJsCompressor;
        }
<span class="nc bnc" id="L1562" title="All 2 branches missed."></span>
<span class="nc" id="L1563">        // detect CDATA wrapper</span>
<span class="nc" id="L1564">        boolean cdataWrapper = false;</span>
        Matcher matcher = cdataPattern.matcher(source);
<span class="nc" id="L1566">        if (matcher.matches()) {</span>
            cdataWrapper = true;
            source = matcher.group(1);
        }
<span class="nc" id="L1570"></span>
<span class="nc" id="L1571">        String result = javaScriptCompressor.compress(source);</span>
<span class="nc bnc" id="L1572" title="All 2 branches missed."></span>
<span class="nc" id="L1573">        if (cdataWrapper) {</span>
<span class="nc" id="L1574">            result = &quot;&lt;![CDATA[&quot; + result + &quot;]]&gt;&quot;;</span>
        }

<span class="nc" id="L1577">        return result;</span>

<span class="nc bnc" id="L1579" title="All 2 branches missed.">    }</span>
<span class="nc" id="L1580"></span>
    /**
     * Compress css styles.
<span class="nc" id="L1583">     *</span>
     * @param source
     *            the source
     * @return the string
     */
    protected String compressCssStyles(String source) {

        // set default css compressor
        if (cssCompressor == null) {
            YuiCssCompressor yuiCssCompressor = new YuiCssCompressor();
<span class="nc" id="L1593">            yuiCssCompressor.setLineBreak(yuiCssLineBreak);</span>
<span class="nc" id="L1594"></span>
<span class="nc" id="L1595">            cssCompressor = yuiCssCompressor;</span>
<span class="nc" id="L1596">        }</span>
<span class="nc" id="L1597"></span>
<span class="nc" id="L1598">        // detect CDATA wrapper</span>
<span class="nc" id="L1599">        boolean cdataWrapper = false;</span>
<span class="nc" id="L1600">        Matcher matcher = cdataPattern.matcher(source);</span>
<span class="nc" id="L1601">        if (matcher.matches()) {</span>
<span class="nc" id="L1602">            cdataWrapper = true;</span>
<span class="nc" id="L1603">            source = matcher.group(1);</span>
<span class="nc" id="L1604">        }</span>
<span class="nc" id="L1605"></span>
<span class="nc" id="L1606">        String result = cssCompressor.compress(source);</span>
<span class="nc" id="L1607"></span>
<span class="nc" id="L1608">        if (cdataWrapper) {</span>
<span class="nc" id="L1609">            result = &quot;&lt;![CDATA[&quot; + result + &quot;]]&gt;&quot;;</span>
<span class="nc" id="L1610">        }</span>
<span class="nc" id="L1611"></span>
<span class="nc" id="L1612">        return result;</span>
<span class="nc" id="L1613"></span>
<span class="nc" id="L1614">    }</span>
<span class="nc" id="L1615"></span>
<span class="nc" id="L1616">    /**</span>
<span class="nc" id="L1617">     * Creates the compressor clone.</span>
<span class="nc" id="L1618">     *</span>
     * @return the html compressor
<span class="nc" id="L1620">     */</span>
    protected HtmlCompressor createCompressorClone() {
        HtmlCompressor clone = new HtmlCompressor();
        clone.setJavaScriptCompressor(javaScriptCompressor);
        clone.setCssCompressor(cssCompressor);
        clone.setRemoveComments(removeComments);
        clone.setRemoveMultiSpaces(removeMultiSpaces);
        clone.setRemoveIntertagSpaces(removeIntertagSpaces);
        clone.setRemoveQuotes(removeQuotes);
        clone.setCompressJavaScript(compressJavaScript);
<span class="nc" id="L1630">        clone.setCompressCss(compressCss);</span>
        clone.setSimpleDoctype(simpleDoctype);
        clone.setRemoveScriptAttributes(removeScriptAttributes);
        clone.setRemoveStyleAttributes(removeStyleAttributes);
        clone.setRemoveLinkAttributes(removeLinkAttributes);
        clone.setRemoveFormAttributes(removeFormAttributes);
        clone.setRemoveInputAttributes(removeInputAttributes);
        clone.setSimpleBooleanAttributes(simpleBooleanAttributes);
        clone.setRemoveJavaScriptProtocol(removeJavaScriptProtocol);
        clone.setRemoveHttpProtocol(removeHttpProtocol);
        clone.setRemoveHttpsProtocol(removeHttpsProtocol);
        clone.setPreservePatterns(preservePatterns);
        clone.setYuiJsNoMunge(yuiJsNoMunge);
        clone.setYuiJsPreserveAllSemiColons(yuiJsPreserveAllSemiColons);
        clone.setYuiJsDisableOptimizations(yuiJsDisableOptimizations);
        clone.setYuiJsLineBreak(yuiJsLineBreak);
        clone.setYuiCssLineBreak(yuiCssLineBreak);
        clone.setYuiErrorReporter(yuiErrorReporter);

        return clone;

<span class="nc" id="L1651">    }</span>
<span class="nc" id="L1652"></span>
    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if JavaScript compression is enabled.
     * 
     * @return current state of JavaScript compression.
     */
    public boolean isCompressJavaScript() {
        return compressJavaScript;
<span class="nc" id="L1660">    }</span>

    /**
     * Enables JavaScript compression within &amp;lt;script&amp;gt; tags using &lt;a
     * href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt; if set to &lt;code&gt;true&lt;/code&gt;. Default
     * is &lt;code&gt;false&lt;/code&gt; for performance reasons.
     * 
     * &lt;p&gt;
     * &lt;b&gt;Note:&lt;/b&gt; Compressing JavaScript is not recommended if pages are compressed dynamically on-the-fly because of
     * performance impact. You should consider putting JavaScript into a separate file and compressing it using
     * standalone YUICompressor for example.
     * &lt;/p&gt;
     * 
     * @param compressJavaScript
     *            set &lt;code&gt;true&lt;/code&gt; to enable JavaScript compression. Default is &lt;code&gt;false&lt;/code&gt;
     * 
     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;
     * 
     */
    public void setCompressJavaScript(boolean compressJavaScript) {
        this.compressJavaScript = compressJavaScript;
<span class="nc" id="L1681">    }</span>
<span class="nc" id="L1682"></span>
    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if CSS compression is enabled.
     * 
     * @return current state of CSS compression.
     */
    public boolean isCompressCss() {
        return compressCss;
    }

    /**
<span class="nc" id="L1693">     * Enables CSS compression within &amp;lt;style&amp;gt; tags using &lt;a</span>
     * href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt; if set to &lt;code&gt;true&lt;/code&gt;. Default
     * is &lt;code&gt;false&lt;/code&gt; for performance reasons.
     * 
     * &lt;p&gt;
     * &lt;b&gt;Note:&lt;/b&gt; Compressing CSS is not recommended if pages are compressed dynamically on-the-fly because of
     * performance impact. You should consider putting CSS into a separate file and compressing it using standalone
     * YUICompressor for example.
     * &lt;/p&gt;
     * 
     * @param compressCss
     *            set &lt;code&gt;true&lt;/code&gt; to enable CSS compression. Default is &lt;code&gt;false&lt;/code&gt;
     * 
     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;
<span class="nc" id="L1707">     * </span>
<span class="nc" id="L1708">     */</span>
    public void setCompressCss(boolean compressCss) {
        this.compressCss = compressCss;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if Yahoo YUI Compressor will only minify javascript without obfuscating local symbols.
     * This corresponds to &lt;code&gt;--nomunge&lt;/code&gt; command line option.
     * 
     * @return &lt;code&gt;nomunge&lt;/code&gt; parameter value used for JavaScript compression.
     * 
<span class="nc" id="L1719">     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;</span>
     */
    public boolean isYuiJsNoMunge() {
        return yuiJsNoMunge;
    }

    /**
     * Tells Yahoo YUI Compressor to only minify javascript without obfuscating local symbols. This corresponds to
     * &lt;code&gt;--nomunge&lt;/code&gt; command line option. This option has effect only if JavaScript compression is enabled.
     * Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * @param yuiJsNoMunge
     *            set &lt;code&gt;true&lt;/code&gt; to enable &lt;code&gt;nomunge&lt;/code&gt; mode
     * 
<span class="nc" id="L1733">     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;</span>
<span class="nc" id="L1734">     */</span>
    public void setYuiJsNoMunge(boolean yuiJsNoMunge) {
        this.yuiJsNoMunge = yuiJsNoMunge;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if Yahoo YUI Compressor will preserve unnecessary semicolons during JavaScript
     * compression. This corresponds to &lt;code&gt;--preserve-semi&lt;/code&gt; command line option.
     * 
     * @return &lt;code&gt;preserve-semi&lt;/code&gt; parameter value used for JavaScript compression.
     * 
<span class="nc" id="L1745">     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;</span>
     */
    public boolean isYuiJsPreserveAllSemiColons() {
        return yuiJsPreserveAllSemiColons;
    }

    /**
     * Tells Yahoo YUI Compressor to preserve unnecessary semicolons during JavaScript compression. This corresponds to
     * &lt;code&gt;--preserve-semi&lt;/code&gt; command line option. This option has effect only if JavaScript compression is
     * enabled. Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * @param yuiJsPreserveAllSemiColons
     *            set &lt;code&gt;true&lt;/code&gt; to enable &lt;code&gt;preserve-semi&lt;/code&gt; mode
     * 
<span class="nc" id="L1759">     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;</span>
<span class="nc" id="L1760">     */</span>
    public void setYuiJsPreserveAllSemiColons(boolean yuiJsPreserveAllSemiColons) {
        this.yuiJsPreserveAllSemiColons = yuiJsPreserveAllSemiColons;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if Yahoo YUI Compressor will disable all the built-in micro optimizations during
     * JavaScript compression. This corresponds to &lt;code&gt;--disable-optimizations&lt;/code&gt; command line option.
     * 
     * @return &lt;code&gt;disable-optimizations&lt;/code&gt; parameter value used for JavaScript compression.
     * 
<span class="nc" id="L1771">     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;</span>
     */
    public boolean isYuiJsDisableOptimizations() {
        return yuiJsDisableOptimizations;
    }

    /**
     * Tells Yahoo YUI Compressor to disable all the built-in micro optimizations during JavaScript compression. This
     * corresponds to &lt;code&gt;--disable-optimizations&lt;/code&gt; command line option. This option has effect only if
     * JavaScript compression is enabled. Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * @param yuiJsDisableOptimizations
     *            set &lt;code&gt;true&lt;/code&gt; to enable &lt;code&gt;disable-optimizations&lt;/code&gt; mode
     * 
<span class="nc" id="L1785">     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;</span>
<span class="nc" id="L1786">     */</span>
    public void setYuiJsDisableOptimizations(boolean yuiJsDisableOptimizations) {
        this.yuiJsDisableOptimizations = yuiJsDisableOptimizations;
    }

    /**
     * Returns number of symbols per line Yahoo YUI Compressor will use during JavaScript compression. This corresponds
     * to &lt;code&gt;--line-break&lt;/code&gt; command line option.
     * 
     * @return &lt;code&gt;line-break&lt;/code&gt; parameter value used for JavaScript compression.
     * 
<span class="nc" id="L1797">     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;</span>
     */
    public int getYuiJsLineBreak() {
        return yuiJsLineBreak;
    }

    /**
     * Tells Yahoo YUI Compressor to break lines after the specified number of symbols during JavaScript compression.
     * This corresponds to &lt;code&gt;--line-break&lt;/code&gt; command line option. This option has effect only if JavaScript
     * compression is enabled. Default is &lt;code&gt;-1&lt;/code&gt; to disable line breaks.
     * 
     * @param yuiJsLineBreak
     *            set number of symbols per line
     * 
<span class="nc" id="L1811">     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;</span>
<span class="nc" id="L1812">     */</span>
    public void setYuiJsLineBreak(int yuiJsLineBreak) {
        this.yuiJsLineBreak = yuiJsLineBreak;
    }

    /**
     * Returns number of symbols per line Yahoo YUI Compressor will use during CSS compression. This corresponds to
     * &lt;code&gt;--line-break&lt;/code&gt; command line option.
<span class="nc" id="L1820">     * </span>
     * @return &lt;code&gt;line-break&lt;/code&gt; parameter value used for CSS compression.
     * 
     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;
     */
    public int getYuiCssLineBreak() {
        return yuiCssLineBreak;
    }

    /**
     * Tells Yahoo YUI Compressor to break lines after the specified number of symbols during CSS compression. This
     * corresponds to &lt;code&gt;--line-break&lt;/code&gt; command line option. This option has effect only if CSS compression is
     * enabled. Default is &lt;code&gt;-1&lt;/code&gt; to disable line breaks.
     * 
     * @param yuiCssLineBreak
     *            set number of symbols per line
<span class="nc" id="L1836">     * </span>
<span class="nc" id="L1837">     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;</span>
     */
    public void setYuiCssLineBreak(int yuiCssLineBreak) {
        this.yuiCssLineBreak = yuiCssLineBreak;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if all unnecessary quotes will be removed from tag attributes.
<span class="nc" id="L1845">     *</span>
     * @return true, if is removes the quotes
     */
    public boolean isRemoveQuotes() {
        return removeQuotes;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt; all unnecessary quotes will be removed from tag attributes. Default is
     * &lt;code&gt;false&lt;/code&gt;.
     * 
<span class="nc" id="L1856">     * &lt;p&gt;</span>
<span class="nc" id="L1857">     * &lt;b&gt;Note:&lt;/b&gt; Even though quotes are removed only when it is safe to do so, it still might break strict HTML</span>
     * validation. Turn this option on only if a page validation is not very important or to squeeze the most out of the
     * compression. This option has no performance impact.
     * 
     * @param removeQuotes
     *            set &lt;code&gt;true&lt;/code&gt; to remove unnecessary quotes from tag attributes
     */
    public void setRemoveQuotes(boolean removeQuotes) {
<span class="nc" id="L1865">        this.removeQuotes = removeQuotes;</span>
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if compression is enabled.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if compression is enabled.
     */
    public boolean isEnabled() {
        return enabled;
<span class="nc" id="L1875">    }</span>
<span class="nc" id="L1876"></span>
    /**
     * If set to &lt;code&gt;false&lt;/code&gt; all compression will be bypassed. Might be useful for testing purposes. Default is
     * &lt;code&gt;true&lt;/code&gt;.
     * 
     * @param enabled
     *            set &lt;code&gt;false&lt;/code&gt; to bypass all compression
     */
<span class="nc" id="L1884">    public void setEnabled(boolean enabled) {</span>
        this.enabled = enabled;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if all HTML comments will be removed.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if all HTML comments will be removed
     */
    public boolean isRemoveComments() {
        return removeComments;
<span class="nc" id="L1895">    }</span>
<span class="nc" id="L1896"></span>
    /**
     * If set to &lt;code&gt;true&lt;/code&gt; all HTML comments will be removed. Default is &lt;code&gt;true&lt;/code&gt;.
     * 
     * @param removeComments
     *            set &lt;code&gt;true&lt;/code&gt; to remove all HTML comments
     */
    public void setRemoveComments(boolean removeComments) {
<span class="nc" id="L1904">        this.removeComments = removeComments;</span>
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if all multiple whitespace characters will be replaced with single spaces.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if all multiple whitespace characters will be replaced with single spaces.
     */
    public boolean isRemoveMultiSpaces() {
        return removeMultiSpaces;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt; all multiple whitespace characters will be replaced with single spaces. Default is
<span class="nc" id="L1918">     * &lt;code&gt;true&lt;/code&gt;.</span>
<span class="nc" id="L1919">     * </span>
     * @param removeMultiSpaces
     *            set &lt;code&gt;true&lt;/code&gt; to replace all multiple whitespace characters will single spaces.
     */
    public void setRemoveMultiSpaces(boolean removeMultiSpaces) {
        this.removeMultiSpaces = removeMultiSpaces;
    }

<span class="nc" id="L1927">    /**</span>
     * Returns &lt;code&gt;true&lt;/code&gt; if all inter-tag whitespace characters will be removed.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if all inter-tag whitespace characters will be removed.
     */
    public boolean isRemoveIntertagSpaces() {
        return removeIntertagSpaces;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt; all inter-tag whitespace characters will be removed. Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * &lt;p&gt;
     * &lt;b&gt;Note:&lt;/b&gt; It is fairly safe to turn this option on unless you rely on spaces for page formatting. Even if you
     * do, you can always preserve required spaces with &lt;code&gt;&amp;amp;nbsp;&lt;/code&gt;. This option has no performance impact.
     * 
     * @param removeIntertagSpaces
     *            set &lt;code&gt;true&lt;/code&gt; to remove all inter-tag whitespace characters
     */
    public void setRemoveIntertagSpaces(boolean removeIntertagSpaces) {
<span class="nc" id="L1947">        this.removeIntertagSpaces = removeIntertagSpaces;</span>
<span class="nc" id="L1948">    }</span>

    /**
     * Returns a list of Patterns defining custom preserving block rules.
     *
     * @return list of &lt;code&gt;Pattern&lt;/code&gt; objects defining rules for preserving block rules
     */
    public List&lt;Pattern&gt; getPreservePatterns() {
        return preservePatterns;
    }

<span class="nc" id="L1959">    /**</span>
     * This method allows setting custom block preservation rules defined by regular expression patterns. Blocks that
     * match provided patterns will be skipped during HTML compression.
     * 
     * &lt;p&gt;
     * Custom preservation rules have higher priority than default rules. Priority between custom rules are defined by
     * their position in a list (beginning of a list has higher priority).
     * 
     * &lt;p&gt;
     * Besides custom patterns, you can use 3 predefined patterns: {@link #PHP_TAG_PATTERN PHP_TAG_PATTERN},
     * {@link #SERVER_SCRIPT_TAG_PATTERN SERVER_SCRIPT_TAG_PATTERN}, {@link #SERVER_SIDE_INCLUDE_PATTERN
     * SERVER_SIDE_INCLUDE_PATTERN}.
     * 
     * @param preservePatterns
     *            List of &lt;code&gt;Pattern&lt;/code&gt; objects that will be used to skip matched blocks during compression
     */
    public void setPreservePatterns(List&lt;Pattern&gt; preservePatterns) {
<span class="nc" id="L1976">        this.preservePatterns = preservePatterns;</span>
<span class="nc" id="L1977">    }</span>

    /**
     * Returns &lt;code&gt;ErrorReporter&lt;/code&gt; used by YUI Compressor to log error messages during JavasSript compression.
     *
     * @return &lt;code&gt;ErrorReporter&lt;/code&gt; used by YUI Compressor to log error messages during JavasSript compression
     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;
     * @see &lt;a href=&quot;http://www.mozilla.org/rhino/apidocs/org/mozilla/javascript/ErrorReporter.html&quot;&gt;Error Reporter
     *      Interface&lt;/a&gt;
     */
    public ErrorReporter getYuiErrorReporter() {
        return yuiErrorReporter;
    }
<span class="nc" id="L1990"></span>
    /**
     * Sets &lt;code&gt;ErrorReporter&lt;/code&gt; that YUI Compressor will use for reporting errors during JavaScript compression.
     * If no &lt;code&gt;ErrorReporter&lt;/code&gt; was provided {@link YuiJavaScriptCompressor.DefaultErrorReporter} will be used
     * which reports errors to &lt;code&gt;System.err&lt;/code&gt; stream.
     * 
     * @param yuiErrorReporter
     *            &lt;code&gt;ErrorReporter&lt;/code&gt; that will be used by YUI Compressor
     * 
     * @see YuiJavaScriptCompressor.DefaultErrorReporter
     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;
     * @see &lt;a href=&quot;http://www.mozilla.org/rhino/apidocs/org/mozilla/javascript/ErrorReporter.html&quot;&gt;ErrorReporter
     *      Interface&lt;/a&gt;
     */
    public void setYuiErrorReporter(ErrorReporter yuiErrorReporter) {
        this.yuiErrorReporter = yuiErrorReporter;
    }

    /**
     * Returns JavaScript compressor implementation that will be used to compress inline JavaScript in HTML.
     * 
     * @return &lt;code&gt;Compressor&lt;/code&gt; implementation that will be used to compress inline JavaScript in HTML.
     * 
     * @see YuiJavaScriptCompressor
     * @see ClosureJavaScriptCompressor
<span class="nc" id="L2015">     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;</span>
<span class="nc" id="L2016">     * @see &lt;a href=&quot;http://code.google.com/closure/compiler/&quot;&gt;Google Closure Compiler&lt;/a&gt;</span>
     */
    public Compressor getJavaScriptCompressor() {
        return javaScriptCompressor;
    }

    /**
     * Sets JavaScript compressor implementation that will be used to compress inline JavaScript in HTML.
     * 
     * &lt;p&gt;
     * HtmlCompressor currently comes with basic implementations for &lt;a
<span class="nc" id="L2027">     * href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt; (called</span>
     * {@link YuiJavaScriptCompressor}) and &lt;a href=&quot;http://code.google.com/closure/compiler/&quot;&gt;Google Closure
     * Compiler&lt;/a&gt; (called {@link ClosureJavaScriptCompressor}) that should be enough for most cases, but users can
     * also create their own JavaScript compressors for custom needs.
     * 
     * &lt;p&gt;
     * If no compressor is set {@link YuiJavaScriptCompressor} will be used by default.
     * 
     * @param javaScriptCompressor
     *            {@link Compressor} implementation that will be used for inline JavaScript compression
     * 
     * @see YuiJavaScriptCompressor
     * @see ClosureJavaScriptCompressor
     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;
     * @see &lt;a href=&quot;http://code.google.com/closure/compiler/&quot;&gt;Google Closure Compiler&lt;/a&gt;
     */
    public void setJavaScriptCompressor(Compressor javaScriptCompressor) {
        this.javaScriptCompressor = javaScriptCompressor;
    }

    /**
<span class="nc" id="L2048">     * Returns CSS compressor implementation that will be used to compress inline CSS in HTML.</span>
<span class="nc" id="L2049">     * </span>
     * @return &lt;code&gt;Compressor&lt;/code&gt; implementation that will be used to compress inline CSS in HTML.
     * 
     * @see YuiCssCompressor
     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;
     */
    public Compressor getCssCompressor() {
        return cssCompressor;
    }

<span class="nc" id="L2059">    /**</span>
     * Sets CSS compressor implementation that will be used to compress inline CSS in HTML.
     * 
     * &lt;p&gt;
     * HtmlCompressor currently comes with basic implementation for &lt;a
     * href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt; (called {@link YuiCssCompressor}), but
     * users can also create their own CSS compressors for custom needs.
     * 
     * &lt;p&gt;
     * If no compressor is set {@link YuiCssCompressor} will be used by default.
     * 
<span class="nc" id="L2070">     * @param cssCompressor</span>
<span class="nc" id="L2071">     *            {@link Compressor} implementation that will be used for inline CSS compression</span>
     * 
     * @see YuiCssCompressor
     * @see &lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot;&gt;Yahoo YUI Compressor&lt;/a&gt;
     */
    public void setCssCompressor(Compressor cssCompressor) {
        this.cssCompressor = cssCompressor;
    }
<span class="nc" id="L2079"></span>
    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if existing DOCTYPE declaration will be replaced with simple
     * &lt;code&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/code&gt; declaration.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if existing DOCTYPE declaration will be replaced with simple
     *         &lt;code&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/code&gt; declaration.
     */
    public boolean isSimpleDoctype() {
        return simpleDoctype;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, existing DOCTYPE declaration will be replaced with simple
     * &lt;code&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/code&gt; declaration. Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * @param simpleDoctype
     *            set &lt;code&gt;true&lt;/code&gt; to replace existing DOCTYPE declaration with &lt;code&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/code&gt;
<span class="nc" id="L2097">     */</span>
<span class="nc" id="L2098">    public void setSimpleDoctype(boolean simpleDoctype) {</span>
        this.simpleDoctype = simpleDoctype;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if unnecessary attributes will be removed from &lt;code&gt;&amp;lt;script&amp;gt;&lt;/code&gt; tags.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if unnecessary attributes will be removed from &lt;code&gt;&amp;lt;script&amp;gt;&lt;/code&gt; tags
     */
    public boolean isRemoveScriptAttributes() {
<span class="nc" id="L2108">        return removeScriptAttributes;</span>
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, following attributes will be removed from &lt;code&gt;&amp;lt;script&amp;gt;&lt;/code&gt; tags:
     * &lt;ul&gt;
     * &lt;li&gt;type=&quot;text/javascript&quot;&lt;/li&gt;
     * &lt;li&gt;type=&quot;application/javascript&quot;&lt;/li&gt;
     * &lt;li&gt;language=&quot;javascript&quot;&lt;/li&gt;
     * &lt;/ul&gt;
     * 
     * &lt;p&gt;
<span class="nc" id="L2120">     * Default is &lt;code&gt;false&lt;/code&gt;.</span>
<span class="nc" id="L2121">     * </span>
     * @param removeScriptAttributes
     *            set &lt;code&gt;true&lt;/code&gt; to remove unnecessary attributes from &lt;code&gt;&amp;lt;script&amp;gt;&lt;/code&gt; tags
     */
    public void setRemoveScriptAttributes(boolean removeScriptAttributes) {
        this.removeScriptAttributes = removeScriptAttributes;
    }

<span class="nc" id="L2129">    /**</span>
     * Returns &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;type=&quot;text/style&quot;&lt;/code&gt; attributes will be removed from
     * &lt;code&gt;&amp;lt;style&amp;gt;&lt;/code&gt; tags.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;type=&quot;text/style&quot;&lt;/code&gt; attributes will be removed from
     *         &lt;code&gt;&amp;lt;style&amp;gt;&lt;/code&gt; tags
     */
    public boolean isRemoveStyleAttributes() {
        return removeStyleAttributes;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, &lt;code&gt;type=&quot;text/style&quot;&lt;/code&gt; attributes will be removed from
     * &lt;code&gt;&amp;lt;style&amp;gt;&lt;/code&gt; tags. Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * @param removeStyleAttributes
     *            set &lt;code&gt;true&lt;/code&gt; to remove &lt;code&gt;type=&quot;text/style&quot;&lt;/code&gt; attributes from
     *            &lt;code&gt;&amp;lt;style&amp;gt;&lt;/code&gt; tags
<span class="nc" id="L2147">     */</span>
<span class="nc" id="L2148">    public void setRemoveStyleAttributes(boolean removeStyleAttributes) {</span>
        this.removeStyleAttributes = removeStyleAttributes;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if unnecessary attributes will be removed from &lt;code&gt;&amp;lt;link&amp;gt;&lt;/code&gt; tags.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if unnecessary attributes will be removed from &lt;code&gt;&amp;lt;link&amp;gt;&lt;/code&gt; tags
     */
    public boolean isRemoveLinkAttributes() {
<span class="nc" id="L2158">        return removeLinkAttributes;</span>
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, following attributes will be removed from &lt;code&gt;&amp;lt;link rel=&quot;stylesheet&quot;&amp;gt;&lt;/code&gt;
     * and &lt;code&gt;&amp;lt;link rel=&quot;alternate stylesheet&quot;&amp;gt;&lt;/code&gt; tags:
     * &lt;ul&gt;
     * &lt;li&gt;type=&quot;text/css&quot;&lt;/li&gt;
     * &lt;li&gt;type=&quot;text/plain&quot;&lt;/li&gt;
     * &lt;/ul&gt;
     * 
     * &lt;p&gt;
<span class="nc" id="L2170">     * Default is &lt;code&gt;false&lt;/code&gt;.</span>
<span class="nc" id="L2171">     * </span>
     * @param removeLinkAttributes
     *            set &lt;code&gt;true&lt;/code&gt; to remove unnecessary attributes from &lt;code&gt;&amp;lt;link&amp;gt;&lt;/code&gt; tags
     */
    public void setRemoveLinkAttributes(boolean removeLinkAttributes) {
        this.removeLinkAttributes = removeLinkAttributes;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;method=&quot;get&quot;&lt;/code&gt; attributes will be removed from &lt;code&gt;&amp;lt;form&amp;gt;&lt;/code&gt;
<span class="nc" id="L2181">     * tags.</span>
     *
     * @return &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;method=&quot;get&quot;&lt;/code&gt; attributes will be removed from &lt;code&gt;&amp;lt;form&amp;gt;&lt;/code&gt;
     *         tags
     */
    public boolean isRemoveFormAttributes() {
        return removeFormAttributes;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, &lt;code&gt;method=&quot;get&quot;&lt;/code&gt; attributes will be removed from &lt;code&gt;&amp;lt;form&amp;gt;&lt;/code&gt;
     * tags. Default is &lt;code&gt;false&lt;/code&gt;.
<span class="nc" id="L2193">     * </span>
<span class="nc" id="L2194">     * @param removeFormAttributes</span>
     *            set &lt;code&gt;true&lt;/code&gt; to remove &lt;code&gt;method=&quot;get&quot;&lt;/code&gt; attributes from &lt;code&gt;&amp;lt;form&amp;gt;&lt;/code&gt;
     *            tags
     */
    public void setRemoveFormAttributes(boolean removeFormAttributes) {
        this.removeFormAttributes = removeFormAttributes;
    }

<span class="nc" id="L2202">    /**</span>
     * Returns &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;type=&quot;text&quot;&lt;/code&gt; attributes will be removed from &lt;code&gt;&amp;lt;input&amp;gt;&lt;/code&gt;
     * tags.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;type=&quot;text&quot;&lt;/code&gt; attributes will be removed from &lt;code&gt;&amp;lt;input&amp;gt;&lt;/code&gt;
     *         tags
     */
    public boolean isRemoveInputAttributes() {
        return removeInputAttributes;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, &lt;code&gt;type=&quot;text&quot;&lt;/code&gt; attributes will be removed from &lt;code&gt;&amp;lt;input&amp;gt;&lt;/code&gt;
     * tags. Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * @param removeInputAttributes
     *            set &lt;code&gt;true&lt;/code&gt; to remove &lt;code&gt;type=&quot;text&quot;&lt;/code&gt; attributes from &lt;code&gt;&amp;lt;input&amp;gt;&lt;/code&gt;
     *            tags
     */
    public void setRemoveInputAttributes(boolean removeInputAttributes) {
        this.removeInputAttributes = removeInputAttributes;
    }
<span class="nc" id="L2224"></span>
<span class="nc" id="L2225">    /**</span>
     * Returns &lt;code&gt;true&lt;/code&gt; if boolean attributes will be simplified.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if boolean attributes will be simplified
     */
    public boolean isSimpleBooleanAttributes() {
        return simpleBooleanAttributes;
    }
<span class="nc" id="L2233"></span>
    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, any values of following boolean attributes will be removed:
     * &lt;ul&gt;
     * &lt;li&gt;checked&lt;/li&gt;
     * &lt;li&gt;selected&lt;/li&gt;
     * &lt;li&gt;disabled&lt;/li&gt;
     * &lt;li&gt;readonly&lt;/li&gt;
     * &lt;/ul&gt;
     * 
     * &lt;p&gt;
     * For example, &lt;code&gt;&amp;lt;input readonly=&quot;readonly&quot;&amp;gt;&lt;/code&gt; would become &lt;code&gt;&amp;lt;input readonly&amp;gt;&lt;/code&gt;
     * 
     * &lt;p&gt;
     * Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * @param simpleBooleanAttributes
<span class="nc" id="L2250">     *            set &lt;code&gt;true&lt;/code&gt; to simplify boolean attributes</span>
<span class="nc" id="L2251">     */</span>
    public void setSimpleBooleanAttributes(boolean simpleBooleanAttributes) {
        this.simpleBooleanAttributes = simpleBooleanAttributes;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;javascript:&lt;/code&gt; pseudo-protocol will be removed from inline event handlers.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;javascript:&lt;/code&gt; pseudo-protocol will be removed from inline event handlers.
     */
<span class="nc" id="L2261">    public boolean isRemoveJavaScriptProtocol() {</span>
        return removeJavaScriptProtocol;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, &lt;code&gt;javascript:&lt;/code&gt; pseudo-protocol will be removed from inline event handlers.
     * 
     * &lt;p&gt;
     * For example, &lt;code&gt;&amp;lt;a onclick=&quot;javascript:alert()&quot;&amp;gt;&lt;/code&gt; would become
     * &lt;code&gt;&amp;lt;a onclick=&quot;alert()&quot;&amp;gt;&lt;/code&gt;
     * 
     * &lt;p&gt;
     * Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * @param removeJavaScriptProtocol
     *            set &lt;code&gt;true&lt;/code&gt; to remove &lt;code&gt;javascript:&lt;/code&gt; pseudo-protocol from inline event handlers.
     */
    public void setRemoveJavaScriptProtocol(boolean removeJavaScriptProtocol) {
        this.removeJavaScriptProtocol = removeJavaScriptProtocol;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;HTTP&lt;/code&gt; protocol will be removed from &lt;code&gt;href&lt;/code&gt;, &lt;code&gt;src&lt;/code&gt;,
     * &lt;code&gt;cite&lt;/code&gt;, and &lt;code&gt;action&lt;/code&gt; tag attributes.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;HTTP&lt;/code&gt; protocol will be removed from &lt;code&gt;href&lt;/code&gt;, &lt;code&gt;src&lt;/code&gt;,
     *         &lt;code&gt;cite&lt;/code&gt;, and &lt;code&gt;action&lt;/code&gt; tag attributes.
<span class="nc" id="L2288">     */</span>
<span class="nc" id="L2289">    public boolean isRemoveHttpProtocol() {</span>
        return removeHttpProtocol;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, &lt;code&gt;HTTP&lt;/code&gt; protocol will be removed from &lt;code&gt;href&lt;/code&gt;, &lt;code&gt;src&lt;/code&gt;,
     * &lt;code&gt;cite&lt;/code&gt;, and &lt;code&gt;action&lt;/code&gt; tag attributes. URL without a protocol would make a browser use
     * document's current protocol instead.
     * 
     * &lt;p&gt;
<span class="nc" id="L2299">     * Tags marked with &lt;code&gt;rel=&quot;external&quot;&lt;/code&gt; will be skipped.</span>
     * 
     * &lt;p&gt;
     * For example:
     * &lt;p&gt;
     * &lt;code&gt;&amp;lt;a href=&quot;http://example.com&quot;&amp;gt; &amp;lt;script src=&quot;http://google.com/js.js&quot; rel=&quot;external&quot;&amp;gt;&lt;/code&gt;
     * &lt;p&gt;
     * would become:
     * &lt;p&gt;
     * &lt;code&gt;&amp;lt;a href=&quot;//example.com&quot;&amp;gt; &amp;lt;script src=&quot;http://google.com/js.js&quot; rel=&quot;external&quot;&amp;gt;&lt;/code&gt;
     * 
     * &lt;p&gt;
     * Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * @param removeHttpProtocol
     *            set &lt;code&gt;true&lt;/code&gt; to remove &lt;code&gt;HTTP&lt;/code&gt; protocol from tag attributes
     */
    public void setRemoveHttpProtocol(boolean removeHttpProtocol) {
        this.removeHttpProtocol = removeHttpProtocol;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;HTTPS&lt;/code&gt; protocol will be removed from &lt;code&gt;href&lt;/code&gt;, &lt;code&gt;src&lt;/code&gt;
     * , &lt;code&gt;cite&lt;/code&gt;, and &lt;code&gt;action&lt;/code&gt; tag attributes.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;HTTPS&lt;/code&gt; protocol will be removed from &lt;code&gt;href&lt;/code&gt;, &lt;code&gt;src&lt;/code&gt;
     *         , &lt;code&gt;cite&lt;/code&gt;, and &lt;code&gt;action&lt;/code&gt; tag attributes.
<span class="nc" id="L2326">     */</span>
<span class="nc" id="L2327">    public boolean isRemoveHttpsProtocol() {</span>
        return removeHttpsProtocol;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, &lt;code&gt;HTTPS&lt;/code&gt; protocol will be removed from &lt;code&gt;href&lt;/code&gt;, &lt;code&gt;src&lt;/code&gt;
     * , &lt;code&gt;cite&lt;/code&gt;, and &lt;code&gt;action&lt;/code&gt; tag attributes. URL without a protocol would make a browser use
     * document's current protocol instead.
<span class="nc" id="L2335">     * </span>
     * &lt;p&gt;
     * Tags marked with &lt;code&gt;rel=&quot;external&quot;&lt;/code&gt; will be skipped.
     * 
     * &lt;p&gt;
     * For example:
     * &lt;p&gt;
     * &lt;code&gt;&amp;lt;a href=&quot;https://example.com&quot;&amp;gt; &amp;lt;script src=&quot;https://google.com/js.js&quot; rel=&quot;external&quot;&amp;gt;&lt;/code&gt;
     * &lt;p&gt;
     * would become:
     * &lt;p&gt;
     * &lt;code&gt;&amp;lt;a href=&quot;//example.com&quot;&amp;gt; &amp;lt;script src=&quot;https://google.com/js.js&quot; rel=&quot;external&quot;&amp;gt;&lt;/code&gt;
     * 
     * &lt;p&gt;
     * Default is &lt;code&gt;false&lt;/code&gt;.
     * 
     * @param removeHttpsProtocol
     *            set &lt;code&gt;true&lt;/code&gt; to remove &lt;code&gt;HTTP&lt;/code&gt; protocol from tag attributes
<span class="nc" id="L2353">     */</span>
<span class="nc" id="L2354">    public void setRemoveHttpsProtocol(boolean removeHttpsProtocol) {</span>
        this.removeHttpsProtocol = removeHttpsProtocol;
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if HTML compression statistics is generated.
     *
     * @return &lt;code&gt;true&lt;/code&gt; if HTML compression statistics is generated
     */
    public boolean isGenerateStatistics() {
        return generateStatistics;
    }
<span class="nc" id="L2366"></span>
    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, HTML compression statistics will be generated.
     * 
     * &lt;p&gt;
     * &lt;strong&gt;Important:&lt;/strong&gt; Enabling statistics makes HTML compressor not thread safe.
     * 
     * &lt;p&gt;
     * Default is &lt;code&gt;false&lt;/code&gt;.
<span class="nc" id="L2375">     * </span>
     * @param generateStatistics
     *            set &lt;code&gt;true&lt;/code&gt; to generate HTML compression statistics
     * 
     * @see #getStatistics()
     */
    public void setGenerateStatistics(boolean generateStatistics) {
        this.generateStatistics = generateStatistics;
    }

    /**
     * Returns {@link HtmlCompressorStatistics} object containing statistics of the last HTML compression, if enabled.
     * Should be called after {@link #compress(String)}
<span class="nc" id="L2388">     * </span>
<span class="nc" id="L2389">     * @return {@link HtmlCompressorStatistics} object containing last HTML compression statistics</span>
     * 
     * @see HtmlCompressorStatistics
     * @see #setGenerateStatistics(boolean)
     */
    public HtmlCompressorStatistics getStatistics() {
        return statistics;
    }
<span class="nc" id="L2397"></span>
    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if line breaks will be preserved.
     * 
     * @return &lt;code&gt;true&lt;/code&gt; if line breaks will be preserved.
     */
    public boolean isPreserveLineBreaks() {
        return preserveLineBreaks;
    }

    /**
     * If set to &lt;code&gt;true&lt;/code&gt;, line breaks will be preserved.
     * 
     * &lt;p&gt;
<span class="nc bnc" id="L2411" title="All 4 branches missed.">     * Default is &lt;code&gt;false&lt;/code&gt;.</span>
<span class="nc" id="L2412">     * </span>
     * @param preserveLineBreaks
<span class="nc" id="L2414">     *            set &lt;code&gt;true&lt;/code&gt; to preserve line breaks</span>
<span class="nc" id="L2415">     */</span>
    public void setPreserveLineBreaks(boolean preserveLineBreaks) {
        this.preserveLineBreaks = preserveLineBreaks;
    }

    /**
     * Returns a comma separated list of tags around which spaces will be removed.
     * 
     * @return a comma separated list of tags around which spaces will be removed.
     */
    public String getRemoveSurroundingSpaces() {
        return removeSurroundingSpaces;
    }

    /**
     * Enables surrounding spaces removal around provided comma separated list of tags.
     * 
     * &lt;p&gt;
     * Besides custom defined lists, you can pass one of 3 predefined lists of tags: {@link #BLOCK_TAGS_MIN
     * BLOCK_TAGS_MIN}, {@link #BLOCK_TAGS_MAX BLOCK_TAGS_MAX}, {@link #ALL_TAGS ALL_TAGS}.
     * 
     * @param tagList
     *            a comma separated list of tags around which spaces will be removed
     */
    public void setRemoveSurroundingSpaces(String tagList) {
        if (tagList != null &amp;&amp; tagList.length() == 0) {
            tagList = null;
        }
        this.removeSurroundingSpaces = tagList;
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>